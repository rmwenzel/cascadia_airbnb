<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Data wrangling &middot; Cascadia Airbnb
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/cascadia_airbnb/public/css/poole.css">
  <link rel="stylesheet" href="/cascadia_airbnb/public/css/syntax.css">
  <link rel="stylesheet" href="/cascadia_airbnb/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/cascadia_airbnb/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/cascadia_airbnb/public/favicon.ico">
  --->

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!--- KaTeX --->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
      onload="renderMathInElement(document.body);"></script>
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">

  <nav class="sidebar-nav">

    <a class="sidebar-nav-item active" href="/cascadia_airbnb/process/">Data wrangling</a>
    <a class="sidebar-nav-item" href="/cascadia_airbnb/explore/">Analysis and Modeling</a>

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/cascadia_airbnb/" title="Home">Cascadia Airbnb</a>
            <small>Analysis of AirBnb listings in Portland, Seattle, and Vancouver.</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="page">
  <h1 class="page-title">Data wrangling</h1>
  	<p>In this notebook we clean and tidy our data, and save analysis and modeling for <a href="./analysis-and-modeling.ipynb">another notebook</a></p>

<h2 id="contents">Contents</h2>

<ul>
  <li><a href="#gather-and-assess">Gather and assess</a></li>
  <li><a href="#clean-and-tidy">Clean and tidy</a>
    <ul>
      <li><a href="#listings-dataset"><code class="language-plaintext highlighter-rouge">listings</code> dataset</a>
        <ul>
          <li><a href="#drop-listings-rows-or-columns">Drop <code class="language-plaintext highlighter-rouge">listings</code> rows or columns</a></li>
          <li><a href="#enforce-listings-dtypes">Enforce <code class="language-plaintext highlighter-rouge">listings</code>dtypes</a></li>
          <li><a href="#missing-listings-values">Missing <code class="language-plaintext highlighter-rouge">listings</code> values</a></li>
          <li><a href="#downcast-listings-dtypes">Downcast <code class="language-plaintext highlighter-rouge">listings</code> dtypes</a></li>
        </ul>
      </li>
      <li><a href="#calendar-dataset"><code class="language-plaintext highlighter-rouge">calendar</code> dataset</a>
        <ul>
          <li><a href="#drop-calendar-rows-or-columns">Drop <code class="language-plaintext highlighter-rouge">calendar</code> rows or columns</a></li>
          <li><a href="#enforce-calendar-dtypes">Enforce <code class="language-plaintext highlighter-rouge">calendar</code> dtypes</a></li>
          <li><a href="#missing-calendar-values">Missing <code class="language-plaintext highlighter-rouge">calendar</code> values</a></li>
          <li><a href="#synchronize-calendar-date">Synchronize <code class="language-plaintext highlighter-rouge">calendar.date</code></a></li>
        </ul>
      </li>
      <li><a href="#create-amenities-features">Create amenities features</a></li>
      <li><a href="#currency-conversion">Currency conversion</a></li>
      <li><a href="#save-cleaned-datasets">Save cleaned datasets</a></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># standard imports
</span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">'darkgrid'</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">pandas.api.types</span> <span class="kn">import</span> <span class="n">CategoricalDtype</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">matplotlib.axes._axes</span> <span class="kn">import</span> <span class="n">_log</span> <span class="k">as</span> <span class="n">matplotlib_axes_logger</span>

<span class="c1"># settings
</span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_columns'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">matplotlib_axes_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s">'ERROR'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="gather-and-assess">Gather and assess</h2>

<p>The data we’re using was compiled by <a href="http://insideairbnb.com/">InsideAirbnb</a> from information made publicly available on <a href="http://airbnb.com">Airbnb</a>. Some interesting disclaimers about the data can be found at the <a href="http://insideairbnb.com/about.html">about page</a> as well as more about Inside Airbnb’s model for estimating occupancy rate. You can find datasets for a very large number of major cities worldwide <a href="http://insideairbnb.com/about.html">here</a>.</p>

<p>For each city, InsideAirbnb provides data sets which are updated roughly monthly. Let’s collect the most recent available for Vancouver (February 16, 2020), Seattle (February 22, 2020), and Portland (February 13, 2020).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># download and unzip datasets for each city
</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'sh getdata.sh'</span><span class="p">);</span>
</code></pre></div></div>

<p>After unzipping and renaming, we have 3 data files for each city.</p>

<table>
  <thead>
    <tr>
      <th>File Name</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>listings.csv</td>
      <td>Detailed Listings data</td>
    </tr>
    <tr>
      <td>calendar.csv</td>
      <td>Detailed Calendar data for listings</td>
    </tr>
    <tr>
      <td>neighbourhoods.geojson</td>
      <td>GeoJSON file of neighbourhoods of the city.</td>
    </tr>
  </tbody>
</table>

<p>These can all be found in the <code class="language-plaintext highlighter-rouge">/data</code> directory.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">load_dfs</span><span class="p">(</span><span class="n">file_prefixes</span><span class="p">,</span> <span class="n">city_names</span><span class="p">,</span> <span class="n">files_path</span><span class="p">):</span>
    <span class="s">"""Load all but .geojson data files for each city into nested dict of dataframes."""</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file_prefix</span> <span class="ow">in</span> <span class="n">file_prefixes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">city_name</span> <span class="ow">in</span> <span class="n">city_names</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">files_path</span> <span class="o">+</span> <span class="n">city_name</span> <span class="o">+</span> <span class="s">'_'</span> <span class="o">+</span> <span class="n">file_prefix</span> <span class="o">+</span> <span class="s">'.csv'</span>
            <span class="n">dfs</span><span class="p">[</span><span class="n">file_prefix</span><span class="p">][</span><span class="n">city_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dfs</span>

<span class="n">file_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s">'listings'</span><span class="p">,</span> <span class="s">'calendar'</span><span class="p">]</span>
<span class="n">city_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'seattle'</span><span class="p">,</span> <span class="s">'portland'</span><span class="p">,</span> <span class="s">'vancouver'</span><span class="p">]</span>
<span class="n">files_path</span> <span class="o">=</span> <span class="s">'data/'</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="n">load_dfs</span><span class="p">(</span><span class="n">file_prefixes</span><span class="p">,</span> <span class="n">city_names</span><span class="p">,</span> <span class="n">files_path</span><span class="p">)</span>
</code></pre></div></div>

<p>Some of the questions we’re interested in involve comparisons between the three cities, so we’ll merge the corresponding dataframes for each city into a single large dataframe.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">merge_dfs</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">file_prefixes</span><span class="p">,</span> <span class="n">city_names</span><span class="p">):</span>
    <span class="s">"""Merge dataframes for each kind of data file."""</span>
    <span class="n">merged_dfs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">file_prefix</span> <span class="ow">in</span> <span class="n">file_prefixes</span><span class="p">:</span>
        <span class="n">dfs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dfs</span><span class="p">[</span><span class="n">file_prefix</span><span class="p">][</span><span class="n">city_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">city_name</span> <span class="ow">in</span> <span class="n">city_names</span><span class="p">]</span>
        <span class="n">merged_dfs</span><span class="p">[</span><span class="n">file_prefix</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">city_names</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">'city'</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">merged_dfs</span><span class="p">[</span><span class="n">file_prefix</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'city'</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">merged_dfs</span>
        
<span class="n">dfs</span> <span class="o">=</span> <span class="n">merge_dfs</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">file_prefixes</span><span class="p">,</span> <span class="n">city_names</span><span class="p">)</span>
</code></pre></div></div>

<p>The main dataset we’ll be relying on is the <code class="language-plaintext highlighter-rouge">listings</code> dataset.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">listings_df</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s">'listings'</span><span class="p">]</span>
<span class="n">listings_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>id</th>
      <th>listing_url</th>
      <th>scrape_id</th>
      <th>last_scraped</th>
      <th>name</th>
      <th>summary</th>
      <th>space</th>
      <th>description</th>
      <th>experiences_offered</th>
      <th>neighborhood_overview</th>
      <th>notes</th>
      <th>transit</th>
      <th>access</th>
      <th>interaction</th>
      <th>house_rules</th>
      <th>thumbnail_url</th>
      <th>medium_url</th>
      <th>picture_url</th>
      <th>xl_picture_url</th>
      <th>host_id</th>
      <th>host_url</th>
      <th>host_name</th>
      <th>host_since</th>
      <th>host_location</th>
      <th>host_about</th>
      <th>host_response_time</th>
      <th>host_response_rate</th>
      <th>host_acceptance_rate</th>
      <th>host_is_superhost</th>
      <th>host_thumbnail_url</th>
      <th>host_picture_url</th>
      <th>host_neighbourhood</th>
      <th>host_listings_count</th>
      <th>host_total_listings_count</th>
      <th>host_verifications</th>
      <th>host_has_profile_pic</th>
      <th>host_identity_verified</th>
      <th>street</th>
      <th>neighbourhood</th>
      <th>neighbourhood_cleansed</th>
      <th>neighbourhood_group_cleansed</th>
      <th>state</th>
      <th>zipcode</th>
      <th>market</th>
      <th>smart_location</th>
      <th>country_code</th>
      <th>country</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>is_location_exact</th>
      <th>property_type</th>
      <th>room_type</th>
      <th>accommodates</th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>beds</th>
      <th>bed_type</th>
      <th>amenities</th>
      <th>square_feet</th>
      <th>price</th>
      <th>weekly_price</th>
      <th>monthly_price</th>
      <th>security_deposit</th>
      <th>cleaning_fee</th>
      <th>guests_included</th>
      <th>extra_people</th>
      <th>minimum_nights</th>
      <th>maximum_nights</th>
      <th>minimum_minimum_nights</th>
      <th>maximum_minimum_nights</th>
      <th>minimum_maximum_nights</th>
      <th>maximum_maximum_nights</th>
      <th>minimum_nights_avg_ntm</th>
      <th>maximum_nights_avg_ntm</th>
      <th>calendar_updated</th>
      <th>has_availability</th>
      <th>availability_30</th>
      <th>availability_60</th>
      <th>availability_90</th>
      <th>availability_365</th>
      <th>calendar_last_scraped</th>
      <th>number_of_reviews</th>
      <th>number_of_reviews_ltm</th>
      <th>first_review</th>
      <th>last_review</th>
      <th>review_scores_rating</th>
      <th>review_scores_accuracy</th>
      <th>review_scores_cleanliness</th>
      <th>review_scores_checkin</th>
      <th>review_scores_communication</th>
      <th>review_scores_location</th>
      <th>review_scores_value</th>
      <th>requires_license</th>
      <th>license</th>
      <th>jurisdiction_names</th>
      <th>instant_bookable</th>
      <th>is_business_travel_ready</th>
      <th>cancellation_policy</th>
      <th>require_guest_profile_picture</th>
      <th>require_guest_phone_verification</th>
      <th>calculated_host_listings_count</th>
      <th>calculated_host_listings_count_entire_homes</th>
      <th>calculated_host_listings_count_private_rooms</th>
      <th>calculated_host_listings_count_shared_rooms</th>
      <th>reviews_per_month</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">seattle</th>
      <th>0</th>
      <td>2318</td>
      <td>https://www.airbnb.com/rooms/2318</td>
      <td>20200222045957</td>
      <td>2020-02-22</td>
      <td>Casa Madrona - Urban Oasis 1 block from the park!</td>
      <td>Gorgeous, architect remodeled, Dutch Colonial ...</td>
      <td>This beautiful, gracious home has been complet...</td>
      <td>Gorgeous, architect remodeled, Dutch Colonial ...</td>
      <td>none</td>
      <td>Madrona is a hidden gem of a neighborhood. It ...</td>
      <td>We adhere to a 10pm -9am quiet hour schedule, ...</td>
      <td>NaN</td>
      <td>Guests can access any part of the house.</td>
      <td>We are a family who live next door and are ava...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>https://a0.muscache.com/im/pictures/02973ad3-a...</td>
      <td>NaN</td>
      <td>2536</td>
      <td>https://www.airbnb.com/users/show/2536</td>
      <td>Megan</td>
      <td>2008-08-26</td>
      <td>Seattle, Washington, United States</td>
      <td>I welcome guests from all walks of life and ev...</td>
      <td>within an hour</td>
      <td>100%</td>
      <td>92%</td>
      <td>t</td>
      <td>https://a0.muscache.com/im/pictures/user/016a1...</td>
      <td>https://a0.muscache.com/im/pictures/user/016a1...</td>
      <td>Minor</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>['email', 'phone', 'reviews', 'jumio', 'offlin...</td>
      <td>t</td>
      <td>f</td>
      <td>Seattle, WA, United States</td>
      <td>Madrona</td>
      <td>Madrona</td>
      <td>Central Area</td>
      <td>WA</td>
      <td>98122</td>
      <td>Seattle</td>
      <td>Seattle, WA</td>
      <td>US</td>
      <td>United States</td>
      <td>47.61082</td>
      <td>-122.29082</td>
      <td>t</td>
      <td>House</td>
      <td>Entire home/apt</td>
      <td>9</td>
      <td>2.5</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>Real Bed</td>
      <td>{Internet,Wifi,Kitchen,"Free parking on premis...</td>
      <td>NaN</td>
      <td>$296.00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>$500.00</td>
      <td>$250.00</td>
      <td>8</td>
      <td>$25.00</td>
      <td>7</td>
      <td>1000</td>
      <td>7</td>
      <td>7</td>
      <td>1000</td>
      <td>1000</td>
      <td>7.0</td>
      <td>1000.0</td>
      <td>4 weeks ago</td>
      <td>t</td>
      <td>6</td>
      <td>36</td>
      <td>65</td>
      <td>65</td>
      <td>2020-02-22</td>
      <td>32</td>
      <td>11</td>
      <td>2008-09-15</td>
      <td>2020-02-01</td>
      <td>100.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>t</td>
      <td>STR-OPLI-19-002837</td>
      <td>{WASHINGTON," Seattle"," WA"}</td>
      <td>f</td>
      <td>f</td>
      <td>strict_14_with_grace_period</td>
      <td>f</td>
      <td>f</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0.23</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6606</td>
      <td>https://www.airbnb.com/rooms/6606</td>
      <td>20200222045957</td>
      <td>2020-02-22</td>
      <td>Fab, private seattle urban cottage!</td>
      <td>This tiny cottage is only 15x10, but it has ev...</td>
      <td>Soo centrally located, this is a little house ...</td>
      <td>This tiny cottage is only 15x10, but it has ev...</td>
      <td>none</td>
      <td>A peaceful yet highly accessible neighborhood,...</td>
      <td>Check in is at three, if you'd like a snack or...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>I often escape to kingston and my place on the...</td>
      <td>Please treat the cottage as if it were your ow...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>https://a0.muscache.com/im/pictures/45742/2111...</td>
      <td>NaN</td>
      <td>14942</td>
      <td>https://www.airbnb.com/users/show/14942</td>
      <td>Joyce</td>
      <td>2009-04-26</td>
      <td>Seattle, Washington, United States</td>
      <td>I am a therapist/innkeeper.I know my city well...</td>
      <td>within a few hours</td>
      <td>90%</td>
      <td>95%</td>
      <td>f</td>
      <td>https://a0.muscache.com/im/users/14942/profile...</td>
      <td>https://a0.muscache.com/im/users/14942/profile...</td>
      <td>Wallingford</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>['email', 'phone', 'facebook', 'reviews', 'kba']</td>
      <td>t</td>
      <td>t</td>
      <td>Seattle, WA, United States</td>
      <td>Wallingford</td>
      <td>Wallingford</td>
      <td>Other neighborhoods</td>
      <td>WA</td>
      <td>98103</td>
      <td>Seattle</td>
      <td>Seattle, WA</td>
      <td>US</td>
      <td>United States</td>
      <td>47.65411</td>
      <td>-122.33761</td>
      <td>t</td>
      <td>Guesthouse</td>
      <td>Entire home/apt</td>
      <td>2</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>Real Bed</td>
      <td>{TV,Internet,Wifi,"Air conditioning",Kitchen,"...</td>
      <td>NaN</td>
      <td>$90.00</td>
      <td>$670.00</td>
      <td>NaN</td>
      <td>$200.00</td>
      <td>$40.00</td>
      <td>2</td>
      <td>$10.00</td>
      <td>30</td>
      <td>1125</td>
      <td>30</td>
      <td>30</td>
      <td>1125</td>
      <td>1125</td>
      <td>30.0</td>
      <td>1125.0</td>
      <td>3 months ago</td>
      <td>t</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>20</td>
      <td>2020-02-22</td>
      <td>150</td>
      <td>16</td>
      <td>2009-07-17</td>
      <td>2019-09-28</td>
      <td>92.0</td>
      <td>9.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>9.0</td>
      <td>t</td>
      <td>NaN</td>
      <td>{WASHINGTON," Seattle"," WA"}</td>
      <td>f</td>
      <td>f</td>
      <td>strict_14_with_grace_period</td>
      <td>f</td>
      <td>f</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>1.16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9419</td>
      <td>https://www.airbnb.com/rooms/9419</td>
      <td>20200222045957</td>
      <td>2020-02-22</td>
      <td>Glorious sun room w/ memory foambed</td>
      <td>This beautiful double room features a magical ...</td>
      <td>Our new Sunny space has a private room from th...</td>
      <td>This beautiful double room features a magical ...</td>
      <td>none</td>
      <td>Lots of restaurants (see our guide book) bars,...</td>
      <td>This area is an arts district,you will see all...</td>
      <td>Car 2 go is in this neigborhood Bus is across ...</td>
      <td>24 /7 access kitchen, bathroom and community s...</td>
      <td>I have a hands on warm approach to guests but ...</td>
      <td>No drugs,no smoking inside *outside in front o...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>https://a0.muscache.com/im/pictures/56645186/e...</td>
      <td>NaN</td>
      <td>30559</td>
      <td>https://www.airbnb.com/users/show/30559</td>
      <td>Angielena</td>
      <td>2009-08-09</td>
      <td>Seattle, Washington, United States</td>
      <td>I am a visual artist who is  the  director of ...</td>
      <td>within a few hours</td>
      <td>100%</td>
      <td>92%</td>
      <td>t</td>
      <td>https://a0.muscache.com/im/users/30559/profile...</td>
      <td>https://a0.muscache.com/im/users/30559/profile...</td>
      <td>Georgetown</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>['email', 'phone', 'reviews', 'jumio', 'offlin...</td>
      <td>t</td>
      <td>t</td>
      <td>Seattle, WA, United States</td>
      <td>Georgetown</td>
      <td>Georgetown</td>
      <td>Other neighborhoods</td>
      <td>WA</td>
      <td>98108</td>
      <td>Seattle</td>
      <td>Seattle, WA</td>
      <td>US</td>
      <td>United States</td>
      <td>47.55017</td>
      <td>-122.31937</td>
      <td>t</td>
      <td>Apartment</td>
      <td>Private room</td>
      <td>2</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>Real Bed</td>
      <td>{Internet,Wifi,"Air conditioning",Kitchen,"Fre...</td>
      <td>200.0</td>
      <td>$62.00</td>
      <td>$580.00</td>
      <td>$1,500.00</td>
      <td>$100.00</td>
      <td>$20.00</td>
      <td>1</td>
      <td>$15.00</td>
      <td>2</td>
      <td>180</td>
      <td>2</td>
      <td>2</td>
      <td>180</td>
      <td>180</td>
      <td>2.0</td>
      <td>180.0</td>
      <td>4 weeks ago</td>
      <td>t</td>
      <td>13</td>
      <td>43</td>
      <td>73</td>
      <td>348</td>
      <td>2020-02-22</td>
      <td>148</td>
      <td>17</td>
      <td>2010-07-30</td>
      <td>2019-12-27</td>
      <td>93.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>t</td>
      <td>str-opli-19-003039</td>
      <td>{WASHINGTON," Seattle"," WA"}</td>
      <td>f</td>
      <td>f</td>
      <td>moderate</td>
      <td>t</td>
      <td>t</td>
      <td>7</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>1.27</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">listings_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 18429 entries, ('seattle', 0) to ('vancouver', 6205)
Columns: 105 entries, id to reviews_per_month
dtypes: float64(21), int64(21), object(63)
memory usage: 14.9+ MB
</code></pre></div></div>

<p>There are 19997 total listings, with 105 columns. Columns are well named and descriptive enough to make sense of the variables they correspond to. We note that lot of these variables are long text strings. This dataset provides a lot of interesting opportunities for natural language processing.</p>

<p>We’ll also be making use of the <code class="language-plaintext highlighter-rouge">calendar</code> dataset</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calendar_df</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s">'calendar'</span><span class="p">]</span>
<span class="n">calendar_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>listing_id</th>
      <th>date</th>
      <th>available</th>
      <th>price</th>
      <th>adjusted_price</th>
      <th>minimum_nights</th>
      <th>maximum_nights</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">seattle</th>
      <th>0</th>
      <td>788146</td>
      <td>2020-02-22</td>
      <td>f</td>
      <td>$68.00</td>
      <td>$68.00</td>
      <td>30.0</td>
      <td>180.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>340706</td>
      <td>2020-02-22</td>
      <td>t</td>
      <td>$90.00</td>
      <td>$90.00</td>
      <td>2.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>340706</td>
      <td>2020-02-23</td>
      <td>t</td>
      <td>$90.00</td>
      <td>$90.00</td>
      <td>2.0</td>
      <td>60.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calendar_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 6726585 entries, ('seattle', 0) to ('vancouver', 2265189)
Data columns (total 7 columns):
 #   Column          Dtype  
---  ------          -----  
 0   listing_id      int64  
 1   date            object 
 2   available       object 
 3   price           object 
 4   adjusted_price  object 
 5   minimum_nights  float64
 6   maximum_nights  float64
dtypes: float64(2), int64(1), object(4)
memory usage: 412.3+ MB
</code></pre></div></div>

<p>There are 7298905 calendar entries, with 7 variables describing them. Again column names are descriptive.</p>

<h2 id="clean-and-tidy">Clean and tidy</h2>

<h4 id="listings-dataset"><code class="language-plaintext highlighter-rouge">listings</code> dataset</h4>

<h5 id="drop-listings-rows-or-columns">Drop <code class="language-plaintext highlighter-rouge">listings</code> rows or columns</h5>

<p>First we check for duplicates</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># number of duplicate rows
</span><span class="n">num_dups</span> <span class="o">=</span> <span class="n">listings_df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">num_dups</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
</code></pre></div></div>

<p>Next we’ll looks at rows or columns containing a lot of missing values. We’ll choose a lower threshold of 25% missing values</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prop_missing_vals_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">"""Get missing values in df by proportion above threshold along axis."""</span>
    <span class="n">prop</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>
    <span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'prop_miss_vals'</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="n">prop</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rows with high proportion of missing values in listings df
</span><span class="n">prop_missing_vals_df</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>prop_miss_vals</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="4" valign="top">vancouver</th>
      <th>3263</th>
      <td>0.323810</td>
    </tr>
    <tr>
      <th>5791</th>
      <td>0.323810</td>
    </tr>
    <tr>
      <th>6006</th>
      <td>0.323810</td>
    </tr>
    <tr>
      <th>5564</th>
      <td>0.323810</td>
    </tr>
    <tr>
      <th>seattle</th>
      <th>7021</th>
      <td>0.323810</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>portland</th>
      <th>4295</th>
      <td>0.257143</td>
    </tr>
    <tr>
      <th>seattle</th>
      <th>764</th>
      <td>0.257143</td>
    </tr>
    <tr>
      <th>portland</th>
      <th>3894</th>
      <td>0.257143</td>
    </tr>
    <tr>
      <th>vancouver</th>
      <th>5921</th>
      <td>0.257143</td>
    </tr>
    <tr>
      <th>seattle</th>
      <th>2987</th>
      <td>0.257143</td>
    </tr>
  </tbody>
</table>
  <p>326 rows × 1 columns</p>
</div>

<p>There are quite 326 rows missing more than 25% of values, but no rows are missing 100% of values. We’ll address these missing values by column instead.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># columns with high proportion of missing values in listings df
</span><span class="n">prop_missing_vals_df</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prop_miss_vals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>xl_picture_url</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>medium_url</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>thumbnail_url</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>square_feet</th>
      <td>0.963536</td>
    </tr>
    <tr>
      <th>monthly_price</th>
      <td>0.906560</td>
    </tr>
    <tr>
      <th>weekly_price</th>
      <td>0.893266</td>
    </tr>
    <tr>
      <th>neighbourhood_group_cleansed</th>
      <td>0.590645</td>
    </tr>
    <tr>
      <th>notes</th>
      <td>0.414618</td>
    </tr>
    <tr>
      <th>access</th>
      <td>0.340713</td>
    </tr>
    <tr>
      <th>host_about</th>
      <td>0.291551</td>
    </tr>
    <tr>
      <th>transit</th>
      <td>0.258994</td>
    </tr>
  </tbody>
</table>
</div>

<p>Inspecting each of these more carefully, we’ll drop all of these columns for the following reasons:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">transit</code>, <code class="language-plaintext highlighter-rouge">host_about</code>, <code class="language-plaintext highlighter-rouge">access</code>, <code class="language-plaintext highlighter-rouge">notes</code>: These are all text fields which would require somewhat sophisticated NLP.</li>
  <li><code class="language-plaintext highlighter-rouge">neighbourhood_group_cleansed</code>: Large proportion of missing values and we can get more precise information from <code class="language-plaintext highlighter-rouge">neighborhood</code></li>
  <li><code class="language-plaintext highlighter-rouge">weekly_price</code>, <code class="language-plaintext highlighter-rouge">monthly_price</code>: Large proportion of missing values and we’re more interested in (daily) <code class="language-plaintext highlighter-rouge">price</code></li>
  <li><code class="language-plaintext highlighter-rouge">square_feet</code>, <code class="language-plaintext highlighter-rouge">thumbnail_url</code>, <code class="language-plaintext highlighter-rouge">xl_picture_url</code>, <code class="language-plaintext highlighter-rouge">medium_url</code>, <code class="language-plaintext highlighter-rouge">host_acceptance_rate</code>: Too high percentage of missing values to be useful.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># start collecting columns to drop from listings df
</span><span class="n">drop_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">prop_missing_vals_df</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</code></pre></div></div>

<p>There are quite a few more columns we can drop. To make this easier to manage, lets display columns of <code class="language-plaintext highlighter-rouge">listings</code> in alphabetical order:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># alphabetize columns besides those selected for dropping and inspect
</span><span class="n">alph_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">listings_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">))</span>
<span class="n">alph_cols</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">listings_df</span><span class="p">[</span><span class="n">alph_cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>accommodates</th>
      <th>amenities</th>
      <th>availability_30</th>
      <th>availability_365</th>
      <th>availability_60</th>
      <th>availability_90</th>
      <th>bathrooms</th>
      <th>bed_type</th>
      <th>bedrooms</th>
      <th>beds</th>
      <th>calculated_host_listings_count</th>
      <th>calculated_host_listings_count_entire_homes</th>
      <th>calculated_host_listings_count_private_rooms</th>
      <th>calculated_host_listings_count_shared_rooms</th>
      <th>calendar_last_scraped</th>
      <th>calendar_updated</th>
      <th>cancellation_policy</th>
      <th>cleaning_fee</th>
      <th>country</th>
      <th>country_code</th>
      <th>description</th>
      <th>experiences_offered</th>
      <th>extra_people</th>
      <th>first_review</th>
      <th>guests_included</th>
      <th>has_availability</th>
      <th>host_acceptance_rate</th>
      <th>host_has_profile_pic</th>
      <th>host_id</th>
      <th>host_identity_verified</th>
      <th>host_is_superhost</th>
      <th>host_listings_count</th>
      <th>host_location</th>
      <th>host_name</th>
      <th>host_neighbourhood</th>
      <th>host_picture_url</th>
      <th>host_response_rate</th>
      <th>host_response_time</th>
      <th>host_since</th>
      <th>host_thumbnail_url</th>
      <th>host_total_listings_count</th>
      <th>host_url</th>
      <th>host_verifications</th>
      <th>house_rules</th>
      <th>id</th>
      <th>instant_bookable</th>
      <th>interaction</th>
      <th>is_business_travel_ready</th>
      <th>is_location_exact</th>
      <th>jurisdiction_names</th>
      <th>last_review</th>
      <th>last_scraped</th>
      <th>latitude</th>
      <th>license</th>
      <th>listing_url</th>
      <th>longitude</th>
      <th>market</th>
      <th>maximum_maximum_nights</th>
      <th>maximum_minimum_nights</th>
      <th>maximum_nights</th>
      <th>maximum_nights_avg_ntm</th>
      <th>minimum_maximum_nights</th>
      <th>minimum_minimum_nights</th>
      <th>minimum_nights</th>
      <th>minimum_nights_avg_ntm</th>
      <th>name</th>
      <th>neighborhood_overview</th>
      <th>neighbourhood</th>
      <th>neighbourhood_cleansed</th>
      <th>number_of_reviews</th>
      <th>number_of_reviews_ltm</th>
      <th>picture_url</th>
      <th>price</th>
      <th>property_type</th>
      <th>require_guest_phone_verification</th>
      <th>require_guest_profile_picture</th>
      <th>requires_license</th>
      <th>review_scores_accuracy</th>
      <th>review_scores_checkin</th>
      <th>review_scores_cleanliness</th>
      <th>review_scores_communication</th>
      <th>review_scores_location</th>
      <th>review_scores_rating</th>
      <th>review_scores_value</th>
      <th>reviews_per_month</th>
      <th>room_type</th>
      <th>scrape_id</th>
      <th>security_deposit</th>
      <th>smart_location</th>
      <th>space</th>
      <th>state</th>
      <th>street</th>
      <th>summary</th>
      <th>zipcode</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seattle</th>
      <th>0</th>
      <td>9</td>
      <td>{Internet,Wifi,Kitchen,"Free parking on premis...</td>
      <td>6</td>
      <td>65</td>
      <td>36</td>
      <td>65</td>
      <td>2.5</td>
      <td>Real Bed</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>2020-02-22</td>
      <td>4 weeks ago</td>
      <td>strict_14_with_grace_period</td>
      <td>$250.00</td>
      <td>United States</td>
      <td>US</td>
      <td>Gorgeous, architect remodeled, Dutch Colonial ...</td>
      <td>none</td>
      <td>$25.00</td>
      <td>2008-09-15</td>
      <td>8</td>
      <td>t</td>
      <td>92%</td>
      <td>t</td>
      <td>2536</td>
      <td>f</td>
      <td>t</td>
      <td>2.0</td>
      <td>Seattle, Washington, United States</td>
      <td>Megan</td>
      <td>Minor</td>
      <td>https://a0.muscache.com/im/pictures/user/016a1...</td>
      <td>100%</td>
      <td>within an hour</td>
      <td>2008-08-26</td>
      <td>https://a0.muscache.com/im/pictures/user/016a1...</td>
      <td>2.0</td>
      <td>https://www.airbnb.com/users/show/2536</td>
      <td>['email', 'phone', 'reviews', 'jumio', 'offlin...</td>
      <td>NaN</td>
      <td>2318</td>
      <td>f</td>
      <td>We are a family who live next door and are ava...</td>
      <td>f</td>
      <td>t</td>
      <td>{WASHINGTON," Seattle"," WA"}</td>
      <td>2020-02-01</td>
      <td>2020-02-22</td>
      <td>47.61082</td>
      <td>STR-OPLI-19-002837</td>
      <td>https://www.airbnb.com/rooms/2318</td>
      <td>-122.29082</td>
      <td>Seattle</td>
      <td>1000</td>
      <td>7</td>
      <td>1000</td>
      <td>1000.0</td>
      <td>1000</td>
      <td>7</td>
      <td>7</td>
      <td>7.0</td>
      <td>Casa Madrona - Urban Oasis 1 block from the park!</td>
      <td>Madrona is a hidden gem of a neighborhood. It ...</td>
      <td>Madrona</td>
      <td>Madrona</td>
      <td>32</td>
      <td>11</td>
      <td>https://a0.muscache.com/im/pictures/02973ad3-a...</td>
      <td>$296.00</td>
      <td>House</td>
      <td>f</td>
      <td>f</td>
      <td>t</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>100.0</td>
      <td>10.0</td>
      <td>0.23</td>
      <td>Entire home/apt</td>
      <td>20200222045957</td>
      <td>$500.00</td>
      <td>Seattle, WA</td>
      <td>This beautiful, gracious home has been complet...</td>
      <td>WA</td>
      <td>Seattle, WA, United States</td>
      <td>Gorgeous, architect remodeled, Dutch Colonial ...</td>
      <td>98122</td>
    </tr>
  </tbody>
</table>
</div>

<p>We’ll also drop the following columns for the following reasons:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">interaction</code>, <code class="language-plaintext highlighter-rouge">neighbourhood_overview</code>, <code class="language-plaintext highlighter-rouge">description</code>, <code class="language-plaintext highlighter-rouge">house_rules</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">space</code>, <code class="language-plaintext highlighter-rouge">summary</code>: Long string text columns that could be useful but would require some NLP (which is beyond this scope of this project).</li>
  <li><code class="language-plaintext highlighter-rouge">calendar_updated</code>, <code class="language-plaintext highlighter-rouge">host_location</code>, <code class="language-plaintext highlighter-rouge">host_name</code>, <code class="language-plaintext highlighter-rouge">host_neighbourhood</code>, <code class="language-plaintext highlighter-rouge">host_picture_url</code>,  <code class="language-plaintext highlighter-rouge">host_thumbnail_url</code>, <code class="language-plaintext highlighter-rouge">host_url</code>, <code class="language-plaintext highlighter-rouge">host_verifications</code>, <code class="language-plaintext highlighter-rouge">is_location_exact</code>, <code class="language-plaintext highlighter-rouge">jurisdiction_names</code>, <code class="language-plaintext highlighter-rouge">lisence</code>, <code class="language-plaintext highlighter-rouge">listing_url</code>, <code class="language-plaintext highlighter-rouge">market</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">picture_url</code>, <code class="language-plaintext highlighter-rouge">scrape_id</code>: Irrelevant for our analysis</li>
  <li><code class="language-plaintext highlighter-rouge">maximum_minimum_nights</code>, <code class="language-plaintext highlighter-rouge">minimum_maximum_nights</code>, <code class="language-plaintext highlighter-rouge">maximum_maximum_nights</code>, <code class="language-plaintext highlighter-rouge">minimum_minimum_nights</code>,  <code class="language-plaintext highlighter-rouge">minimum_nights_avg_ntm</code>, <code class="language-plaintext highlighter-rouge">maximum_nights_avg_ntm</code> - Difficult to interpret and possibly less relevant (given presence of <code class="language-plaintext highlighter-rouge">minimum_nights</code>, <code class="language-plaintext highlighter-rouge">maximum_nights</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">last_scraped</code>, <code class="language-plaintext highlighter-rouge">calendar_last_scraped</code>, <code class="language-plaintext highlighter-rouge">country</code>, <code class="language-plaintext highlighter-rouge">country_code</code>, <code class="language-plaintext highlighter-rouge">experiences_offered</code>, <code class="language-plaintext highlighter-rouge">has_availability</code>: All have the same value for this dataset</li>
  <li><code class="language-plaintext highlighter-rouge">host_has_profile_pic</code>: Extreme class imbalance (99.8% vs. 0.2%).</li>
  <li><code class="language-plaintext highlighter-rouge">smart_location</code>: Highly imbalanced and superceded by other variables.</li>
  <li><code class="language-plaintext highlighter-rouge">street</code>: Doesn’t even contain street information!</li>
  <li><code class="language-plaintext highlighter-rouge">state</code>: Redundant (given city information) and not relevant</li>
  <li><code class="language-plaintext highlighter-rouge">zipcode</code>: Superceded by other more useful geographic variables (<code class="language-plaintext highlighter-rouge">neighbourhood</code>, <code class="language-plaintext highlighter-rouge">latitude</code>, <code class="language-plaintext highlighter-rouge">longitude</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">host_listings_count</code>, <code class="language-plaintext highlighter-rouge">host_total_listings_count</code>, <code class="language-plaintext highlighter-rouge">neighbourhood</code>: Appears to be from original AirBnB data - superceded by other variables created by Inside AirBnB (names beginning    with prefix <code class="language-plaintext highlighter-rouge">calculated_</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">number_of_reviews_ltm</code> - meaning unclear</li>
</ul>

<p>That was a lot of detailed justification! But it can be helpful to be explicit and clear about reasons for ignoring information.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># add remaining columns to drop and drop
</span><span class="n">more_drop_cols</span> <span class="o">=</span> <span class="p">{</span><span class="s">'interaction'</span><span class="p">,</span> <span class="s">'neighborhood_overview'</span><span class="p">,</span> <span class="s">'description'</span><span class="p">,</span> <span class="s">'house_rules'</span><span class="p">,</span> 
                  <span class="s">'name'</span><span class="p">,</span> <span class="s">'space'</span><span class="p">,</span> <span class="s">'summary'</span><span class="p">,</span> <span class="s">'calendar_updated'</span><span class="p">,</span> <span class="s">'host_location'</span><span class="p">,</span>
                  <span class="s">'host_name'</span><span class="p">,</span> <span class="s">'host_neighbourhood'</span><span class="p">,</span> <span class="s">'host_picture_url'</span><span class="p">,</span> 
                  <span class="s">'host_thumbnail_url'</span><span class="p">,</span> <span class="s">'host_url'</span><span class="p">,</span> <span class="s">'host_verifications'</span><span class="p">,</span> 
                  <span class="s">'is_location_exact'</span><span class="p">,</span> <span class="s">'jurisdiction_names'</span><span class="p">,</span> <span class="s">'listing_url'</span><span class="p">,</span> <span class="s">'market'</span><span class="p">,</span> 
                  <span class="s">'name'</span><span class="p">,</span> <span class="s">'picture_url'</span><span class="p">,</span> <span class="s">'scrape_id'</span><span class="p">,</span> <span class="s">'maximum_minimum_nights'</span><span class="p">,</span> 
                  <span class="s">'minimum_maximum_nights'</span><span class="p">,</span> <span class="s">'maximum_maximum_nights'</span><span class="p">,</span> 
                  <span class="s">'minimum_minimum_nights'</span><span class="p">,</span> <span class="s">'minimum_nights_avg_ntm'</span><span class="p">,</span>
                  <span class="s">'maximum_nights_avg_ntm'</span><span class="p">,</span> <span class="s">'last_scraped'</span><span class="p">,</span> <span class="s">'calendar_last_scraped'</span><span class="p">,</span> 
                  <span class="s">'country'</span><span class="p">,</span> <span class="s">'country_code'</span><span class="p">,</span> <span class="s">'experiences_offered'</span><span class="p">,</span> <span class="s">'has_availability'</span><span class="p">,</span> 
                  <span class="s">'host_has_profile_pic'</span><span class="p">,</span> <span class="s">'smart_location'</span><span class="p">,</span> <span class="s">'street'</span><span class="p">,</span> <span class="s">'state'</span><span class="p">,</span> 
                  <span class="s">'host_listings_count'</span><span class="p">,</span> <span class="s">'host_total_listings_count'</span><span class="p">,</span> 
                  <span class="s">'neighbourhood'</span><span class="p">,</span> <span class="s">'zipcode'</span><span class="p">,</span> <span class="s">'number_of_reviews_ltm'</span><span class="p">,</span> <span class="s">'license'</span><span class="p">}</span>
<span class="n">drop_cols</span> <span class="o">=</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">more_drop_cols</span><span class="p">)</span>
<span class="n">listings_df</span> <span class="o">=</span> <span class="n">listings_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_cols</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">alphabetize_cols</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">first_col</span><span class="o">=</span><span class="s">'id'</span><span class="p">):</span>
    <span class="s">"""Alphabetize columns."""</span>
    <span class="n">df_cp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">alph_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_cp</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">sort_values</span><span class="p">())</span>
    <span class="n">alph_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">first_col</span><span class="p">)</span>
    <span class="n">alph_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_col</span><span class="p">]</span> <span class="o">+</span> <span class="n">alph_cols</span>
    <span class="n">df_cp</span> <span class="o">=</span> <span class="n">df_cp</span><span class="p">[</span><span class="n">alph_cols</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df_cp</span>

<span class="n">listings_df</span> <span class="o">=</span> <span class="n">alphabetize_cols</span><span class="p">(</span><span class="n">listings_df</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="enforce-listings-dtypes">Enforce <code class="language-plaintext highlighter-rouge">listings</code> dtypes</h5>

<p>Now that we’re left with the variables we’re interested in, we’ll see if any need processing before we deal with missing values and setting dtypes</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">listings_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s">'int64'</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 18429 entries, ('seattle', 0) to ('vancouver', 6205)
Data columns (total 15 columns):
 #   Column                                        Non-Null Count  Dtype
---  ------                                        --------------  -----
 0   id                                            18429 non-null  int64
 1   accommodates                                  18429 non-null  int64
 2   availability_30                               18429 non-null  int64
 3   availability_365                              18429 non-null  int64
 4   availability_60                               18429 non-null  int64
 5   availability_90                               18429 non-null  int64
 6   calculated_host_listings_count                18429 non-null  int64
 7   calculated_host_listings_count_entire_homes   18429 non-null  int64
 8   calculated_host_listings_count_private_rooms  18429 non-null  int64
 9   calculated_host_listings_count_shared_rooms   18429 non-null  int64
 10  guests_included                               18429 non-null  int64
 11  host_id                                       18429 non-null  int64
 12  maximum_nights                                18429 non-null  int64
 13  minimum_nights                                18429 non-null  int64
 14  number_of_reviews                             18429 non-null  int64
dtypes: int64(15)
memory usage: 2.2+ MB
</code></pre></div></div>

<p>All of the variables with integer type look good. Also since <code class="language-plaintext highlighter-rouge">np.nan</code> is a float, we can conclude all these variables have no missing values</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">listings_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s">'float64'</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 18429 entries, ('seattle', 0) to ('vancouver', 6205)
Data columns (total 13 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   bathrooms                    18424 non-null  float64
 1   bedrooms                     18409 non-null  float64
 2   beds                         18383 non-null  float64
 3   latitude                     18429 non-null  float64
 4   longitude                    18429 non-null  float64
 5   review_scores_accuracy       15990 non-null  float64
 6   review_scores_checkin        15989 non-null  float64
 7   review_scores_cleanliness    15990 non-null  float64
 8   review_scores_communication  15993 non-null  float64
 9   review_scores_location       15990 non-null  float64
 10  review_scores_rating         15999 non-null  float64
 11  review_scores_value          15991 non-null  float64
 12  reviews_per_month            16089 non-null  float64
dtypes: float64(13)
memory usage: 1.9+ MB
</code></pre></div></div>

<p>All of these variables are indeed numerical. Some of them could be converted to ints – this may speed computations and reduce the chance of rounding errors. Since <code class="language-plaintext highlighter-rouge">np.nan</code> is a float however, we’ll wait until after we handle missing values. Let’s look at which floats can be safely converted to ints.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">can_conv_to_int</span><span class="p">(</span><span class="n">list_float_vars</span><span class="p">):</span>
    <span class="s">"""Check which float values can be converted to int without rounding."""</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">list_float_vars</span><span class="p">)</span> <span class="o">-</span> <span class="n">list_float_vars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nb">any</span><span class="p">()</span>
    <span class="k">return</span> <span class="o">~</span> <span class="n">res</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dictionary for tracking col dtype conversions
</span><span class="n">conv_dtypes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
<span class="c1"># see which float columns can be safely converted to int
</span><span class="n">conv_to_int</span> <span class="o">=</span> <span class="n">can_conv_to_int</span><span class="p">(</span><span class="n">listings_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s">'float64'</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<span class="n">conv_to_int_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">conv_to_int</span><span class="p">[</span><span class="n">conv_to_int</span><span class="o">.</span><span class="n">T</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'int'</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_to_int_cols</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'int'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'bedrooms',
 'beds',
 'review_scores_accuracy',
 'review_scores_checkin',
 'review_scores_cleanliness',
 'review_scores_communication',
 'review_scores_location',
 'review_scores_rating',
 'review_scores_value'}
</code></pre></div></div>

<p>So we can safely convert all but <code class="language-plaintext highlighter-rouge">reviews_per_month</code>, <code class="language-plaintext highlighter-rouge">longitude</code>, <code class="language-plaintext highlighter-rouge">latitude</code>, and <code class="language-plaintext highlighter-rouge">bathrooms</code> to integer type (after we’ve dealt with missing values)</p>

<p>Finally let’s look at object variables</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">listings_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s">'object'</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 18429 entries, ('seattle', 0) to ('vancouver', 6205)
Data columns (total 23 columns):
 #   Column                            Non-Null Count  Dtype 
---  ------                            --------------  ----- 
 0   amenities                         18429 non-null  object
 1   bed_type                          18429 non-null  object
 2   cancellation_policy               18429 non-null  object
 3   cleaning_fee                      17148 non-null  object
 4   extra_people                      18429 non-null  object
 5   first_review                      16089 non-null  object
 6   host_acceptance_rate              17008 non-null  object
 7   host_identity_verified            18428 non-null  object
 8   host_is_superhost                 18428 non-null  object
 9   host_response_rate                15535 non-null  object
 10  host_response_time                15535 non-null  object
 11  host_since                        18428 non-null  object
 12  instant_bookable                  18429 non-null  object
 13  is_business_travel_ready          18429 non-null  object
 14  last_review                       16089 non-null  object
 15  neighbourhood_cleansed            18429 non-null  object
 16  price                             18429 non-null  object
 17  property_type                     18429 non-null  object
 18  require_guest_phone_verification  18429 non-null  object
 19  require_guest_profile_picture     18429 non-null  object
 20  requires_license                  18429 non-null  object
 21  room_type                         18429 non-null  object
 22  security_deposit                  15649 non-null  object
dtypes: object(23)
memory usage: 3.3+ MB
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">listings_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s">'object'</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>amenities</th>
      <th>bed_type</th>
      <th>cancellation_policy</th>
      <th>cleaning_fee</th>
      <th>extra_people</th>
      <th>first_review</th>
      <th>host_acceptance_rate</th>
      <th>host_identity_verified</th>
      <th>host_is_superhost</th>
      <th>host_response_rate</th>
      <th>host_response_time</th>
      <th>host_since</th>
      <th>instant_bookable</th>
      <th>is_business_travel_ready</th>
      <th>last_review</th>
      <th>neighbourhood_cleansed</th>
      <th>price</th>
      <th>property_type</th>
      <th>require_guest_phone_verification</th>
      <th>require_guest_profile_picture</th>
      <th>requires_license</th>
      <th>room_type</th>
      <th>security_deposit</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seattle</th>
      <th>0</th>
      <td>{Internet,Wifi,Kitchen,"Free parking on premis...</td>
      <td>Real Bed</td>
      <td>strict_14_with_grace_period</td>
      <td>$250.00</td>
      <td>$25.00</td>
      <td>2008-09-15</td>
      <td>92%</td>
      <td>f</td>
      <td>t</td>
      <td>100%</td>
      <td>within an hour</td>
      <td>2008-08-26</td>
      <td>f</td>
      <td>f</td>
      <td>2020-02-01</td>
      <td>Madrona</td>
      <td>$296.00</td>
      <td>House</td>
      <td>f</td>
      <td>f</td>
      <td>t</td>
      <td>Entire home/apt</td>
      <td>$500.00</td>
    </tr>
  </tbody>
</table>
</div>

<p>Some of these variables can be converted to other appropriate types, without additional processing. We’re careful not to cast to boolean dtype with missing data since pandas will automatically convert <code class="language-plaintext highlighter-rouge">np.nan</code> to <code class="language-plaintext highlighter-rouge">True</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># non-ordered categorical variables
</span><span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'categorical'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'host_identity_verified'</span><span class="p">,</span> <span class="s">'host_is_superhost'</span><span class="p">,</span> <span class="s">'instant_bookable'</span><span class="p">,</span> 
                              <span class="s">'is_business_travel_ready'</span><span class="p">,</span> <span class="s">'neighbourhood_cleansed'</span><span class="p">,</span> <span class="s">'property_type'</span><span class="p">,</span> 
                              <span class="s">'require_guest_phone_verification'</span><span class="p">,</span> <span class="s">'require_guest_profile_picture'</span><span class="p">,</span> 
                              <span class="s">'requires_license'</span><span class="p">}</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'datetime'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'first_review'</span><span class="p">,</span> <span class="s">'host_since'</span><span class="p">,</span> <span class="s">'last_review'</span><span class="p">}</span>

<span class="n">listings_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'categorical'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">conv_dtypes</span><span class="p">[</span>
                                                 <span class="s">'categorical'</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">listings_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'datetime'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'datetime'</span><span class="p">]]</span>\
                                           <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'datetime64'</span><span class="p">)</span>
</code></pre></div></div>

<p>We also have a some categorical data types with natural orderings, since there’s a natural way of assigning a price value to them.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">set_ord_cat_dtypes</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">conv_dtypes</span><span class="p">,</span> <span class="n">ord_cat_cols</span><span class="p">):</span>
    <span class="s">"""Set ordered categorical columns dtypes."""</span>
    <span class="n">listings_df_cp</span> <span class="o">=</span> <span class="n">listings_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">ordering</span><span class="p">)</span> <span class="ow">in</span> <span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'ordered_categorical'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ordering</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">listings_df_cp</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">listings_df_cp</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">listings_df_cp</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ordered categorical variables
</span><span class="n">ord_cat_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'bed_type'</span><span class="p">,</span> <span class="s">'cancellation_policy'</span><span class="p">,</span> <span class="s">'host_response_time'</span><span class="p">,</span> <span class="s">'room_type'</span><span class="p">]</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'ordered_categorical'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span><span class="bp">None</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ord_cat_cols</span><span class="p">}</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'ordered_categorical'</span><span class="p">][</span><span class="s">'bed_type'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Couch'</span><span class="p">,</span> <span class="s">'Airbed'</span><span class="p">,</span> <span class="s">'Pull-out Sofa'</span><span class="p">,</span> 
                                                  <span class="s">'Futon'</span><span class="p">,</span> <span class="s">'Real Bed'</span><span class="p">]</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'ordered_categorical'</span><span class="p">][</span><span class="s">'cancellation_policy'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'super_strict_60'</span><span class="p">,</span> 
                                                             <span class="s">'super_strict_30'</span><span class="p">,</span> 
                                                             <span class="s">'strict'</span><span class="p">,</span> 
                                                             <span class="s">'strict_14_with_grace_period'</span><span class="p">,</span> 
                                                             <span class="s">'moderate'</span><span class="p">,</span> <span class="s">'flexible'</span><span class="p">]</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'ordered_categorical'</span><span class="p">][</span><span class="s">'host_response_time'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'within an hour'</span><span class="p">,</span> 
                                                            <span class="s">'within a few hours'</span><span class="p">,</span> 
                                                            <span class="s">'within a day'</span><span class="p">,</span> 
                                                            <span class="s">'a few days of more'</span><span class="p">]</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'ordered_categorical'</span><span class="p">][</span><span class="s">'room_type'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Shared room'</span><span class="p">,</span> <span class="s">'Hotel room'</span><span class="p">,</span> 
                                                   <span class="s">'Private room'</span><span class="p">,</span> <span class="s">'Entire home/apt'</span><span class="p">]</span>
<span class="n">listings_df</span> <span class="o">=</span> <span class="n">set_ord_cat_dtypes</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">conv_dtypes</span><span class="p">,</span> <span class="n">ord_cat_cols</span><span class="p">)</span>
</code></pre></div></div>

<p>Finally, some of the object variables need to be processed. Some can be easily converted to floats – in this case, it doesn’t matter if <code class="language-plaintext highlighter-rouge">np.nan</code> is present or not.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">conv_to_float</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="s">"""Float conversion helper."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">entry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'$'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">entry</span>
    
<span class="k">def</span> <span class="nf">conv_cols</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">conv_dtypes</span><span class="p">,</span> <span class="n">conv_func</span><span class="p">,</span> <span class="n">dtype_name</span><span class="p">):</span>
    <span class="s">"""Process/convert columns."""</span>
    <span class="n">listings_df_cp</span> <span class="o">=</span> <span class="n">listings_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">conv_dtypes</span><span class="p">[</span><span class="n">dtype_name</span><span class="p">]:</span>
        <span class="n">listings_df_cp</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">conv_func</span><span class="p">)</span>\
                              <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">listings_df_cp</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># some float variables
</span><span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'float'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'cleaning_fee'</span><span class="p">,</span> <span class="s">'extra_people'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> 
                        <span class="s">'security_deposit'</span><span class="p">,</span> <span class="s">'host_response_rate'</span><span class="p">,</span> 
                        <span class="s">'host_acceptance_rate'</span><span class="p">}</span>
<span class="n">listings_df</span> <span class="o">=</span> <span class="n">conv_cols</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">conv_dtypes</span><span class="p">,</span> <span class="n">conv_to_float</span><span class="p">,</span> <span class="s">'float'</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="missing-listings-values">Missing <code class="language-plaintext highlighter-rouge">listings</code> values</h5>

<p>Now we’ll take a look at missing values</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># columns in listings dataset missing values
</span><span class="n">miss_vals_df</span> <span class="o">=</span> <span class="n">prop_missing_vals_df</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">miss_vals_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'col'</span><span class="p">:</span> <span class="n">miss_vals_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                            <span class="s">'prop_miss'</span><span class="p">:</span> <span class="n">miss_vals_df</span><span class="p">[</span><span class="s">'prop_miss_vals'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                             <span class="s">'dtype'</span><span class="p">:</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">miss_vals_df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span><span class="p">})</span>
<span class="n">miss_vals_df</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col</th>
      <th>prop_miss</th>
      <th>dtype</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>host_response_time</th>
      <td>host_response_time</td>
      <td>0.165446</td>
      <td>category</td>
    </tr>
    <tr>
      <th>host_response_rate</th>
      <td>host_response_rate</td>
      <td>0.157035</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>security_deposit</th>
      <td>security_deposit</td>
      <td>0.150849</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_checkin</th>
      <td>review_scores_checkin</td>
      <td>0.132400</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_location</th>
      <td>review_scores_location</td>
      <td>0.132346</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_cleanliness</th>
      <td>review_scores_cleanliness</td>
      <td>0.132346</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_accuracy</th>
      <td>review_scores_accuracy</td>
      <td>0.132346</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_value</th>
      <td>review_scores_value</td>
      <td>0.132291</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_communication</th>
      <td>review_scores_communication</td>
      <td>0.132183</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_rating</th>
      <td>review_scores_rating</td>
      <td>0.131857</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>reviews_per_month</th>
      <td>reviews_per_month</td>
      <td>0.126974</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>last_review</th>
      <td>last_review</td>
      <td>0.126974</td>
      <td>datetime64[ns]</td>
    </tr>
    <tr>
      <th>first_review</th>
      <td>first_review</td>
      <td>0.126974</td>
      <td>datetime64[ns]</td>
    </tr>
    <tr>
      <th>host_acceptance_rate</th>
      <td>host_acceptance_rate</td>
      <td>0.077107</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>cleaning_fee</th>
      <td>cleaning_fee</td>
      <td>0.069510</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>beds</th>
      <td>beds</td>
      <td>0.002496</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>bedrooms</th>
      <td>bedrooms</td>
      <td>0.001085</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>bathrooms</th>
      <td>bathrooms</td>
      <td>0.000271</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>host_identity_verified</th>
      <td>host_identity_verified</td>
      <td>0.000054</td>
      <td>category</td>
    </tr>
    <tr>
      <th>host_since</th>
      <td>host_since</td>
      <td>0.000054</td>
      <td>datetime64[ns]</td>
    </tr>
    <tr>
      <th>host_is_superhost</th>
      <td>host_is_superhost</td>
      <td>0.000054</td>
      <td>category</td>
    </tr>
  </tbody>
</table>
</div>

<p>First focussing on review-related variables missing variables, we notice the proportion of missing values is very close.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># review related variables missing values
</span><span class="n">miss_val_rev_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">miss_vals_df</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="s">'review'</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
<span class="n">miss_vals_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">miss_val_rev_cols</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col</th>
      <th>prop_miss</th>
      <th>dtype</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>review_scores_checkin</th>
      <td>review_scores_checkin</td>
      <td>0.132400</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_location</th>
      <td>review_scores_location</td>
      <td>0.132346</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_cleanliness</th>
      <td>review_scores_cleanliness</td>
      <td>0.132346</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_accuracy</th>
      <td>review_scores_accuracy</td>
      <td>0.132346</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_value</th>
      <td>review_scores_value</td>
      <td>0.132291</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_communication</th>
      <td>review_scores_communication</td>
      <td>0.132183</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>review_scores_rating</th>
      <td>review_scores_rating</td>
      <td>0.131857</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>reviews_per_month</th>
      <td>reviews_per_month</td>
      <td>0.126974</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>last_review</th>
      <td>last_review</td>
      <td>0.126974</td>
      <td>datetime64[ns]</td>
    </tr>
    <tr>
      <th>first_review</th>
      <td>first_review</td>
      <td>0.126974</td>
      <td>datetime64[ns]</td>
    </tr>
  </tbody>
</table>
</div>

<p>We’re both interested in the review variables as responses varialbes, so imputing is problematic, especially given the high percentage of missing values. Moreover, it’s possible that the some listings are missing values for all review variables.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prop of listings missing all review variables
</span><span class="n">miss_val_rev_df</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">listings_df</span><span class="p">[</span><span class="n">miss_val_rev_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="nb">all</span><span class="p">()]</span>\
                            <span class="p">[</span><span class="n">miss_val_rev_cols</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">miss_val_rev_df</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">listings_df</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.1269737913071789
</code></pre></div></div>

<p>So almost all of the variables missing some review information are missing all review information. Let’s compare summary statistics for the listings missing all review information to summary statistics for the entire dataset.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># summary statistics for listings missing review variable values
</span><span class="n">listings_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">miss_val_rev_df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>accommodates</th>
      <th>availability_30</th>
      <th>availability_365</th>
      <th>availability_60</th>
      <th>availability_90</th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>beds</th>
      <th>calculated_host_listings_count</th>
      <th>calculated_host_listings_count_entire_homes</th>
      <th>calculated_host_listings_count_private_rooms</th>
      <th>calculated_host_listings_count_shared_rooms</th>
      <th>cleaning_fee</th>
      <th>extra_people</th>
      <th>guests_included</th>
      <th>host_acceptance_rate</th>
      <th>host_id</th>
      <th>host_response_rate</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>maximum_nights</th>
      <th>minimum_nights</th>
      <th>number_of_reviews</th>
      <th>price</th>
      <th>review_scores_accuracy</th>
      <th>review_scores_checkin</th>
      <th>review_scores_cleanliness</th>
      <th>review_scores_communication</th>
      <th>review_scores_location</th>
      <th>review_scores_rating</th>
      <th>review_scores_value</th>
      <th>reviews_per_month</th>
      <th>security_deposit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.340000e+03</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2339.000000</td>
      <td>2331.000000</td>
      <td>2300.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>1878.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>1865.000000</td>
      <td>2.340000e+03</td>
      <td>1811.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.000000</td>
      <td>2340.0</td>
      <td>2340.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1734.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.414823e+07</td>
      <td>3.338889</td>
      <td>14.158547</td>
      <td>157.964103</td>
      <td>31.888889</td>
      <td>50.710256</td>
      <td>1.340744</td>
      <td>1.422136</td>
      <td>1.717826</td>
      <td>51.204274</td>
      <td>47.062821</td>
      <td>1.230769</td>
      <td>0.525641</td>
      <td>111.756656</td>
      <td>10.141026</td>
      <td>1.678205</td>
      <td>85.252011</td>
      <td>1.093410e+08</td>
      <td>94.926560</td>
      <td>47.739875</td>
      <td>-122.692045</td>
      <td>777.929487</td>
      <td>20.210684</td>
      <td>0.0</td>
      <td>218.774359</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>466.691465</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.352976e+06</td>
      <td>2.105213</td>
      <td>12.568005</td>
      <td>129.301803</td>
      <td>24.766538</td>
      <td>36.762457</td>
      <td>0.645418</td>
      <td>1.008679</td>
      <td>1.257231</td>
      <td>95.190725</td>
      <td>95.449701</td>
      <td>2.958844</td>
      <td>4.424825</td>
      <td>101.441680</td>
      <td>19.850892</td>
      <td>1.424858</td>
      <td>25.003858</td>
      <td>1.130969e+08</td>
      <td>16.545621</td>
      <td>1.398476</td>
      <td>0.345667</td>
      <td>530.030688</td>
      <td>30.511747</td>
      <td>0.0</td>
      <td>512.201897</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>783.654495</td>
    </tr>
    <tr>
      <th>min</th>
      <td>4.814600e+04</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.014300e+04</td>
      <td>0.000000</td>
      <td>45.436220</td>
      <td>-123.218790</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.267230e+07</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>43.750000</td>
      <td>0.000000</td>
      <td>4.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>50.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>68.000000</td>
      <td>8.534462e+06</td>
      <td>99.000000</td>
      <td>47.547308</td>
      <td>-123.106838</td>
      <td>90.000000</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>89.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.707740e+07</td>
      <td>2.000000</td>
      <td>14.000000</td>
      <td>126.000000</td>
      <td>38.000000</td>
      <td>63.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>89.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>99.000000</td>
      <td>4.880712e+07</td>
      <td>100.000000</td>
      <td>47.636640</td>
      <td>-122.673940</td>
      <td>1125.000000</td>
      <td>30.000000</td>
      <td>0.0</td>
      <td>142.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>300.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4.094748e+07</td>
      <td>4.000000</td>
      <td>28.000000</td>
      <td>274.000000</td>
      <td>58.000000</td>
      <td>88.000000</td>
      <td>1.500000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>28.000000</td>
      <td>13.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>145.000000</td>
      <td>20.000000</td>
      <td>2.000000</td>
      <td>100.000000</td>
      <td>2.225925e+08</td>
      <td>100.000000</td>
      <td>49.253462</td>
      <td>-122.337650</td>
      <td>1125.000000</td>
      <td>30.000000</td>
      <td>0.0</td>
      <td>200.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>500.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.244232e+07</td>
      <td>20.000000</td>
      <td>30.000000</td>
      <td>365.000000</td>
      <td>60.000000</td>
      <td>90.000000</td>
      <td>7.000000</td>
      <td>13.000000</td>
      <td>19.000000</td>
      <td>302.000000</td>
      <td>302.000000</td>
      <td>25.000000</td>
      <td>57.000000</td>
      <td>656.000000</td>
      <td>350.000000</td>
      <td>20.000000</td>
      <td>100.000000</td>
      <td>3.368498e+08</td>
      <td>100.000000</td>
      <td>49.293880</td>
      <td>-122.240950</td>
      <td>9999.000000</td>
      <td>365.000000</td>
      <td>0.0</td>
      <td>9999.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6709.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># summary statistics for full listings dataset
</span><span class="n">listings_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>accommodates</th>
      <th>availability_30</th>
      <th>availability_365</th>
      <th>availability_60</th>
      <th>availability_90</th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>beds</th>
      <th>calculated_host_listings_count</th>
      <th>calculated_host_listings_count_entire_homes</th>
      <th>calculated_host_listings_count_private_rooms</th>
      <th>calculated_host_listings_count_shared_rooms</th>
      <th>cleaning_fee</th>
      <th>extra_people</th>
      <th>guests_included</th>
      <th>host_acceptance_rate</th>
      <th>host_id</th>
      <th>host_response_rate</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>maximum_nights</th>
      <th>minimum_nights</th>
      <th>number_of_reviews</th>
      <th>price</th>
      <th>review_scores_accuracy</th>
      <th>review_scores_checkin</th>
      <th>review_scores_cleanliness</th>
      <th>review_scores_communication</th>
      <th>review_scores_location</th>
      <th>review_scores_rating</th>
      <th>review_scores_value</th>
      <th>reviews_per_month</th>
      <th>security_deposit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.842900e+04</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18424.000000</td>
      <td>18409.000000</td>
      <td>18383.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>17148.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>17008.000000</td>
      <td>1.842900e+04</td>
      <td>15535.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>18429.000000</td>
      <td>15990.000000</td>
      <td>15989.000000</td>
      <td>15990.000000</td>
      <td>15993.000000</td>
      <td>15990.00000</td>
      <td>15999.000000</td>
      <td>15991.000000</td>
      <td>16089.000000</td>
      <td>15649.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.389069e+07</td>
      <td>3.568126</td>
      <td>12.350426</td>
      <td>148.143307</td>
      <td>28.582506</td>
      <td>46.318248</td>
      <td>1.295538</td>
      <td>1.417622</td>
      <td>1.858075</td>
      <td>17.553476</td>
      <td>15.576591</td>
      <td>0.824896</td>
      <td>0.252700</td>
      <td>80.080651</td>
      <td>13.715448</td>
      <td>1.970644</td>
      <td>91.943438</td>
      <td>8.178062e+07</td>
      <td>97.533891</td>
      <td>47.643656</td>
      <td>-122.676035</td>
      <td>612.999891</td>
      <td>11.241250</td>
      <td>55.183081</td>
      <td>159.907483</td>
      <td>9.766354</td>
      <td>9.826756</td>
      <td>9.655159</td>
      <td>9.834615</td>
      <td>9.81207</td>
      <td>95.576224</td>
      <td>9.540742</td>
      <td>2.411813</td>
      <td>306.152662</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.238720e+07</td>
      <td>2.157336</td>
      <td>11.021889</td>
      <td>121.067805</td>
      <td>22.045518</td>
      <td>32.808867</td>
      <td>0.628650</td>
      <td>1.019990</td>
      <td>1.367288</td>
      <td>56.309083</td>
      <td>55.606749</td>
      <td>2.218354</td>
      <td>3.339698</td>
      <td>67.365202</td>
      <td>23.227078</td>
      <td>1.584518</td>
      <td>17.186222</td>
      <td>9.396449e+07</td>
      <td>10.668785</td>
      <td>1.420644</td>
      <td>0.336688</td>
      <td>559.068779</td>
      <td>23.188497</td>
      <td>82.727205</td>
      <td>258.998090</td>
      <td>0.662001</td>
      <td>0.600856</td>
      <td>0.733419</td>
      <td>0.607892</td>
      <td>0.53100</td>
      <td>6.720840</td>
      <td>0.761208</td>
      <td>2.201809</td>
      <td>515.534116</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.318000e+03</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.618000e+03</td>
      <td>0.000000</td>
      <td>45.434560</td>
      <td>-123.218790</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.00000</td>
      <td>20.000000</td>
      <td>2.000000</td>
      <td>0.010000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.410369e+07</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>44.000000</td>
      <td>3.000000</td>
      <td>12.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>93.000000</td>
      <td>8.534462e+06</td>
      <td>100.000000</td>
      <td>45.591890</td>
      <td>-123.088580</td>
      <td>30.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>76.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>9.000000</td>
      <td>10.000000</td>
      <td>10.00000</td>
      <td>94.000000</td>
      <td>9.000000</td>
      <td>0.620000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.464953e+07</td>
      <td>3.000000</td>
      <td>11.000000</td>
      <td>123.000000</td>
      <td>30.000000</td>
      <td>51.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>60.000000</td>
      <td>7.000000</td>
      <td>1.000000</td>
      <td>99.000000</td>
      <td>3.836791e+07</td>
      <td>100.000000</td>
      <td>47.634460</td>
      <td>-122.637710</td>
      <td>1124.000000</td>
      <td>2.000000</td>
      <td>21.000000</td>
      <td>113.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.00000</td>
      <td>98.000000</td>
      <td>10.000000</td>
      <td>1.790000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.516444e+07</td>
      <td>4.000000</td>
      <td>23.000000</td>
      <td>252.000000</td>
      <td>49.000000</td>
      <td>77.000000</td>
      <td>1.500000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>4.000000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>100.000000</td>
      <td>20.000000</td>
      <td>2.000000</td>
      <td>100.000000</td>
      <td>1.342970e+08</td>
      <td>100.000000</td>
      <td>49.248060</td>
      <td>-122.341340</td>
      <td>1125.000000</td>
      <td>30.000000</td>
      <td>73.000000</td>
      <td>180.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.00000</td>
      <td>99.000000</td>
      <td>10.000000</td>
      <td>3.670000</td>
      <td>500.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.244232e+07</td>
      <td>26.000000</td>
      <td>30.000000</td>
      <td>365.000000</td>
      <td>60.000000</td>
      <td>90.000000</td>
      <td>16.000000</td>
      <td>30.000000</td>
      <td>49.000000</td>
      <td>302.000000</td>
      <td>302.000000</td>
      <td>25.000000</td>
      <td>57.000000</td>
      <td>700.000000</td>
      <td>399.000000</td>
      <td>20.000000</td>
      <td>100.000000</td>
      <td>3.368498e+08</td>
      <td>100.000000</td>
      <td>49.293880</td>
      <td>-122.240950</td>
      <td>10000.000000</td>
      <td>998.000000</td>
      <td>828.000000</td>
      <td>13000.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>10.00000</td>
      <td>100.000000</td>
      <td>10.000000</td>
      <td>16.650000</td>
      <td>6709.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p>The summary statistics suggest that, for listings missing review information the distributions of variables are different, than the distributions for all listings, so dropping these listings could bias the results. However, our analysis focuses on review variables, and moreover since they will be used as response variables, imputation seems like a bad plan. We’ll go ahead drop rows missing any review variables</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># drop rows missing any review variables
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">miss_val_rev_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">listings_df</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</code></pre></div></div>

<p>We’ll also drop <code class="language-plaintext highlighter-rouge">last_review</code> and <code class="language-plaintext highlighter-rouge">first_review</code> columns as these are probably not too relevant for our analysis (although <code class="language-plaintext highlighter-rouge">number_of_reviews</code> and <code class="language-plaintext highlighter-rouge">reviews_per_month</code> will be)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># drop two more review columns
</span><span class="n">listings_df</span> <span class="o">=</span> <span class="n">listings_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'first_review'</span><span class="p">,</span> <span class="s">'last_review'</span><span class="p">])</span>
</code></pre></div></div>

<p>Now focusing on the variables <code class="language-plaintext highlighter-rouge">bedrooms</code>, <code class="language-plaintext highlighter-rouge">bathrooms</code>, <code class="language-plaintext highlighter-rouge">beds</code>, <code class="language-plaintext highlighter-rouge">host_since</code>, <code class="language-plaintext highlighter-rouge">host_identity_verified</code>, <code class="language-plaintext highlighter-rouge">host_is_superhost</code>, we notice all have less than 1% missing values, so simple imputation choices seem unproblematic here. Let’s look at their distributions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># quantitative variables with small proportion of missing values
</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">'bathrooms'</span><span class="p">,</span> <span class="s">'beds'</span><span class="p">,</span> <span class="s">'bedrooms'</span><span class="p">]):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">listings_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/cascadia_airbnb/assets/images/wrangling_71_0.png" alt="png" /></p>

<p>Each of these variables is highly peaked and highly right skewed, so the imputing them with the mode (instead of mean or median) is a reasonable choice</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># categorical variables with small proportion of missing values
</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">'host_is_superhost'</span><span class="p">,</span> <span class="s">'host_identity_verified'</span><span class="p">]):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">listings_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/cascadia_airbnb/assets/images/wrangling_73_0.png" alt="png" /></p>

<p>These binary variables are fairly evenly distributed, so the imputing them with mode is a reasonable choice.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dictionary for imputation methods for columns with missing values
</span><span class="n">impute_vals</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="c1"># imputation values for some columns
</span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'bathrooms'</span><span class="p">,</span> <span class="s">'beds'</span><span class="p">,</span> <span class="s">'bedrooms'</span><span class="p">,</span> <span class="s">'host_since'</span><span class="p">,</span>
            <span class="s">'host_is_superhost'</span><span class="p">,</span> <span class="s">'host_identity_verified'</span><span class="p">]:</span>
    <span class="n">impute_vals</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>Now let’s look at the distributions of <code class="language-plaintext highlighter-rouge">host_acceptance_rate</code>, <code class="language-plaintext highlighter-rouge">cleaning_fee</code> and  <code class="language-plaintext highlighter-rouge">security_deposit</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">'host_acceptance_rate'</span><span class="p">,</span> <span class="s">'cleaning_fee'</span><span class="p">,</span> <span class="s">'security_deposit'</span><span class="p">]):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">listings_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">norm_hist</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/cascadia_airbnb/assets/images/wrangling_77_0.png" alt="png" /></p>

<p>Given the large peak around zero for <code class="language-plaintext highlighter-rouge">security_deposit</code> and around 100 for <code class="language-plaintext highlighter-rouge">host_acceptance_rate</code>, and the the fact that it seems reasonable to assign a value of zero to a listing that doesn’t have security deposit information available, we’ll use this for our imputation value. We’ll use median for <code class="language-plaintext highlighter-rouge">cleaning_fee</code>, since it’s highly peaked and skewed at a non-zero value.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># imputation values for more columns
</span><span class="n">impute_vals</span><span class="p">[</span><span class="s">'security_deposit'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">impute_vals</span><span class="p">[</span><span class="s">'cleaning_fee'</span><span class="p">]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="s">'cleaning_fee'</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">impute_vals</span><span class="p">[</span><span class="s">'host_acceptance_rate'</span><span class="p">]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="s">'host_acceptance_rate'</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</code></pre></div></div>

<p>Finally let’s look at the distributions of <code class="language-plaintext highlighter-rouge">host_response_rate</code> and <code class="language-plaintext highlighter-rouge">host_response_time</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">listings_df</span><span class="p">[</span><span class="s">'host_response_rate'</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">norm_hist</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">listings_df</span><span class="p">[</span><span class="s">'host_response_time'</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x14362b280&gt;
</code></pre></div></div>

<p><img src="/cascadia_airbnb/assets/images/wrangling_81_1.png" alt="png" /></p>

<p>Given the large skewness and peaks, we’ll impute these with mode as well</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># last imputation values
</span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'host_response_rate'</span><span class="p">,</span> <span class="s">'host_response_time'</span><span class="p">]:</span>
    <span class="n">impute_vals</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># impute all missing values
</span><span class="n">listings_df</span> <span class="o">=</span> <span class="n">listings_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">impute_vals</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="downcast-listings-dtypes">Downcast <code class="language-plaintext highlighter-rouge">listings</code> dtypes</h5>

<p>In the last section we noted that some float variables could be downcast to ints to speed up computation. We’ll do that now.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># downcast to int
</span><span class="n">listings_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'int'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'int'</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'int'</span><span class="p">)</span> 
</code></pre></div></div>

<p>Now that we have no missing values, we can also cast some categorical to boolean dtypes</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">conv_to_bool</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="s">"""Convert string entries to booleans."""</span>
    <span class="k">return</span> <span class="n">entry</span> <span class="o">==</span> <span class="s">'t'</span>

<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'bool'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'host_identity_verified'</span><span class="p">,</span> <span class="s">'host_is_superhost'</span><span class="p">,</span> 
                       <span class="s">'instant_bookable'</span><span class="p">,</span> <span class="s">'is_business_travel_ready'</span><span class="p">,</span> 
                       <span class="s">'require_guest_phone_verification'</span><span class="p">,</span>
                       <span class="s">'require_guest_profile_picture'</span><span class="p">,</span> <span class="s">'requires_license'</span><span class="p">}</span>

<span class="c1"># downcast to boolean
</span><span class="n">listings_df</span> <span class="o">=</span> <span class="n">conv_cols</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">conv_dtypes</span><span class="p">,</span> <span class="n">conv_to_bool</span><span class="p">,</span> <span class="s">'bool'</span><span class="p">)</span> 
</code></pre></div></div>

<h4 id="calendar-dataset"><code class="language-plaintext highlighter-rouge">calendar</code> dataset</h4>

<h5 id="drop-calendar-rows-or-columns">Drop <code class="language-plaintext highlighter-rouge">calendar</code> rows or columns</h5>

<p>We check for duplicates</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_dups</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">num_dups</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
</code></pre></div></div>

<p>Next we’ll looks at rows or columns containing a lot of missing values. We’ll choose a lower threshold of 25% missing values</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rows with high proportion of missing values in listings df
</span><span class="n">prop_missing_vals_df</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>prop_miss_vals</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="11" valign="top">vancouver</th>
      <th>175625</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>463</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>461</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>460</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>459</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>197337</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>197336</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>197335</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>197353</th>
      <td>0.285714</td>
    </tr>
    <tr>
      <th>197351</th>
      <td>0.285714</td>
    </tr>
  </tbody>
</table>
  <p>1084 rows × 1 columns</p>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># columns with high proportion of missing values in listings df
</span><span class="n">prop_missing_vals_df</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prop_miss_vals</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

<p>No columns are missing &gt;25% of values, but 1084 rows are missing about 28.5% of values. We’ll look closer at these rows.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rows missing values
</span><span class="n">miss_vals_df</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">calendar_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">miss_vals_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 1084 entries, ('portland', 298877) to ('vancouver', 1856971)
Data columns (total 7 columns):
 #   Column          Non-Null Count  Dtype  
---  ------          --------------  -----  
 0   listing_id      1084 non-null   int64  
 1   date            1084 non-null   object 
 2   available       1084 non-null   object 
 3   price           5 non-null      object 
 4   adjusted_price  5 non-null      object 
 5   minimum_nights  1079 non-null   float64
 6   maximum_nights  1079 non-null   float64
dtypes: float64(2), int64(1), object(4)
memory usage: 21.1+ MB
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># listing ids of calendar entries with missing values
</span><span class="n">miss_cal_idx</span> <span class="o">=</span> <span class="n">miss_vals_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'city'</span><span class="p">,</span> <span class="s">'listing_id'</span><span class="p">])[</span><span class="s">'listing_id'</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">miss_cal_idx</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>city       listing_id
portland   6132497         5
vancouver  906964        178
           5807056       178
           7150429       179
           14237741        8
           27466923      179
           38825501      178
           39093654      179
Name: listing_id, dtype: int64
</code></pre></div></div>

<p>The missing calendar rows are concentrated in just eight listing ids. Six of these listing ids are missing a large number of entries (around half a year of data), we’ll drop these from both data sets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># drop listing ids with large number of missing entries
</span><span class="n">listing_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">miss_cal_idx</span><span class="p">[</span><span class="n">miss_cal_idx</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">}</span>
<span class="n">list_ids_mask</span> <span class="o">=</span> <span class="o">~</span> <span class="n">listings_df</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">listing_ids</span><span class="p">)</span>
<span class="n">listings_df</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="n">list_ids_mask</span><span class="p">]</span>
<span class="n">cal_ids_mask</span> <span class="o">=</span> <span class="o">~</span> <span class="n">calendar_df</span><span class="p">[</span><span class="s">'listing_id'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">listing_ids</span><span class="p">)</span>
<span class="n">calendar_df</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="p">[</span><span class="n">cal_ids_mask</span><span class="p">]</span>
</code></pre></div></div>

<p>We’ll also drop <code class="language-plaintext highlighter-rouge">adjusted_price</code>. This appears to be a variable added by InsideAirBnB, but couldn’t find any information about it. Furthermore, we assume <code class="language-plaintext highlighter-rouge">price</code> in the <code class="language-plaintext highlighter-rouge">calendar</code> dataset is the equivalent to <code class="language-plaintext highlighter-rouge">price</code> in <code class="language-plaintext highlighter-rouge">listings</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calendar_df</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'adjusted_price'</span><span class="p">])</span>
</code></pre></div></div>

<h5 id="enforce-calendar-dtypes">Enforce <code class="language-plaintext highlighter-rouge">calendar</code> dtypes</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calendar_df</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listing_id          int64
date               object
available          object
price              object
minimum_nights    float64
maximum_nights    float64
dtype: object
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set dtypes
</span><span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'datetime64'</span><span class="p">)</span>
<span class="n">conv_dtypes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'bool'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'available'</span><span class="p">}</span>
<span class="n">conv_dtypes</span><span class="p">[</span><span class="s">'float'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'price'</span><span class="p">}</span>
<span class="n">calendar_df</span> <span class="o">=</span> <span class="n">conv_cols</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">,</span> <span class="n">conv_dtypes</span><span class="p">,</span> <span class="n">conv_to_bool</span><span class="p">,</span> <span class="s">'bool'</span><span class="p">)</span>
<span class="n">calendar_df</span> <span class="o">=</span> <span class="n">conv_cols</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">,</span> <span class="n">conv_dtypes</span><span class="p">,</span> <span class="n">conv_to_float</span><span class="p">,</span> <span class="s">'float'</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="missing-calendar-values">Missing <code class="language-plaintext highlighter-rouge">calendar</code> values</h5>

<p>Finally we’ll deal with the remaining missing values in <code class="language-plaintext highlighter-rouge">calendar</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">miss_vals_df</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">calendar_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">miss_vals_df</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>listing_id</th>
      <th>date</th>
      <th>available</th>
      <th>price</th>
      <th>minimum_nights</th>
      <th>maximum_nights</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="8" valign="top">vancouver</th>
      <th>398064</th>
      <td>14237741</td>
      <td>2021-02-07</td>
      <td>False</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>398065</th>
      <td>14237741</td>
      <td>2021-02-08</td>
      <td>False</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>398066</th>
      <td>14237741</td>
      <td>2021-02-09</td>
      <td>False</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>398067</th>
      <td>14237741</td>
      <td>2021-02-10</td>
      <td>False</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>398068</th>
      <td>14237741</td>
      <td>2021-02-11</td>
      <td>False</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>398069</th>
      <td>14237741</td>
      <td>2021-02-12</td>
      <td>False</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>398070</th>
      <td>14237741</td>
      <td>2021-02-13</td>
      <td>False</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>398071</th>
      <td>14237741</td>
      <td>2021-02-14</td>
      <td>False</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>30.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>To deal with the missing <code class="language-plaintext highlighter-rouge">minimum_nights</code> and <code class="language-plaintext highlighter-rouge">maximum_nights</code> for listing 6132497, we’ll look for other values of these variables for this listing.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># unique values of maximum nights
</span><span class="n">calendar_df</span><span class="p">[</span><span class="n">calendar_df</span><span class="p">[</span><span class="s">'listing_id'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6132497</span><span class="p">][</span><span class="s">'maximum_nights'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([28., nan])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># unique values of maximum nights
</span><span class="n">calendar_df</span><span class="p">[</span><span class="n">calendar_df</span><span class="p">[</span><span class="s">'listing_id'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6132497</span><span class="p">][</span><span class="s">'minimum_nights'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([ 1., nan])
</code></pre></div></div>

<p>Since this listing only ever had one non-null value for these variables, it makes sense to impute that</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># fill missing values for listing 6132497
</span><span class="n">miss_cal_idx</span> <span class="o">=</span> <span class="n">miss_vals_df</span><span class="p">[</span><span class="n">miss_vals_df</span><span class="p">[</span><span class="s">'listing_id'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6132497</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">miss_cal_idx</span><span class="p">,</span> <span class="s">'minimum_nights'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">miss_cal_idx</span><span class="p">,</span> <span class="s">'maximum_nights'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">28.0</span>
</code></pre></div></div>

<p>The remaining missing values for listing 14237741 are all in the same week. It makes sense to backfill with prices from the corresponding days on the previous week.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">backfill_missing_prices</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">,</span> <span class="n">miss_price_vals_df</span><span class="p">):</span>
    <span class="s">"""Backfill missing price data for two listings in calendar dataset."""</span>
    <span class="n">week_delta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">'w'</span><span class="p">)</span>
    <span class="n">calendar_df_cp</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">miss_price_vals_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">listing_id</span> <span class="o">=</span> <span class="n">miss_price_vals_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s">'listing_id'</span><span class="p">]</span>
        <span class="n">one_week_ago</span> <span class="o">=</span> <span class="n">miss_price_vals_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s">'date'</span><span class="p">]</span> <span class="o">-</span> <span class="n">week_delta</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">calendar_df_cp</span><span class="p">[</span><span class="s">'listing_id'</span><span class="p">]</span> <span class="o">==</span> <span class="n">listing_id</span><span class="p">)</span> <span class="o">&amp;</span> 
               <span class="p">(</span><span class="n">calendar_df_cp</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">==</span> <span class="n">one_week_ago</span><span class="p">))</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">calendar_df_cp</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s">'price'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">calendar_df_cp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s">'price'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span>
    <span class="k">return</span> <span class="n">calendar_df_cp</span>

<span class="n">miss_price_vals_df</span> <span class="o">=</span> <span class="n">miss_vals_df</span><span class="p">[</span><span class="n">miss_vals_df</span><span class="p">[</span><span class="s">'listing_id'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">14237741</span><span class="p">]</span>
<span class="n">calendar_df</span> <span class="o">=</span> <span class="n">backfill_missing_prices</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">,</span> <span class="n">miss_price_vals_df</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check backfill worked
</span><span class="nb">len</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">[(</span><span class="n">cal_id_mask</span><span class="p">)</span> <span class="o">&amp;</span>  <span class="n">calendar_df</span><span class="p">[</span><span class="s">'price'</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
</code></pre></div></div>

<h5 id="synchronize-calendardate">Synchronize <code class="language-plaintext highlighter-rouge">calendar.date</code></h5>

<p>The calendar data for the three cities was collected at different times, so we need to sync up the dates for comparison.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">maxmin_date</span> <span class="o">=</span> <span class="s">'2020-02-22'</span>
<span class="n">minmax_date</span> <span class="o">=</span> <span class="s">'2021-02-13'</span>
<span class="n">cal_date_mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">calendar_df</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">maxmin_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">calendar_df</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">minmax_date</span><span class="p">))</span>
<span class="n">calendar_df</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="p">[</span><span class="n">cal_date_mask</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="create-amenities-features">Create amenities features.</h3>

<p>There’s a lot of potentially useful information in the <code class="language-plaintext highlighter-rouge">amentities</code> column but it’s going to take a little bit of work to get it. Currently the entries in the amenities columns are long strings containing amenities for that listing.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">amenities_series</span> <span class="o">=</span> <span class="n">listings_df</span><span class="p">[</span><span class="s">'amenities'</span><span class="p">]</span>
<span class="n">amenities_series</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>city           
seattle    0       {Internet,Wifi,Kitchen,"Free parking on premis...
           1       {TV,Internet,Wifi,"Air conditioning",Kitchen,"...
           2       {Internet,Wifi,"Air conditioning",Kitchen,"Fre...
           3       {TV,"Cable TV",Wifi,"Air conditioning",Kitchen...
           4       {TV,"Cable TV",Internet,Wifi,"Wheelchair acces...
                                         ...                        
vancouver  6130    {Wifi,Kitchen,"Free street parking",Heating,Wa...
           6145    {TV,Wifi,Kitchen,"Paid parking off premises","...
           6150    {TV,Wifi,"Air conditioning",Pool,Kitchen,Gym,E...
           6152    {TV,"Cable TV",Wifi,Kitchen,"Free parking on p...
           6174    {Wifi,Kitchen,Breakfast,"Free street parking",...
Name: amenities, Length: 15983, dtype: object
</code></pre></div></div>

<p>To proceed we need to do a bit of processing.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">process_amenities</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">):</span>
    <span class="s">"""Process entries in amenities series."""</span>
    <span class="c1"># convert amenities lists into sets of strings
</span>    <span class="n">amenities_series</span> <span class="o">=</span> <span class="n">amenities_series</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)))</span>
    <span class="c1"># set for tracking unique amenities
</span>    <span class="n">amenities_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c1"># for dropping all non alphanumeric characters
</span>    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'[^0-9a-zA-Z ]+'</span><span class="p">)</span>
    <span class="c1"># function for processing each amenity lists in series entries
</span>    <span class="k">def</span> <span class="nf">process_and_add</span><span class="p">(</span><span class="n">amenities_set</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">amens_entry</span><span class="p">):</span>
        <span class="n">new_amens_entry</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">amen</span> <span class="ow">in</span> <span class="n">amens_entry</span><span class="p">:</span>
            <span class="c1"># drop non alpha numeric
</span>            <span class="n">amen</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">amen</span><span class="p">)</span>
            <span class="c1"># don't keep track of translation failures
</span>            <span class="k">if</span> <span class="s">'translation'</span> <span class="ow">in</span> <span class="n">amen</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_amens_entry</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">amen</span><span class="p">)</span>
                <span class="c1"># add to main set if it hasn't been seen
</span>                <span class="k">if</span> <span class="n">amen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">amenities_set</span><span class="p">:</span>
                    <span class="n">amenities_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">amen</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_amens_entry</span>
    <span class="c1"># process amenity list entries in series
</span>    <span class="n">apply_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">process_and_add</span><span class="p">,</span> <span class="n">amenities_set</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
    <span class="n">amenities_series</span> <span class="o">=</span> <span class="n">amenities_series</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">apply_func</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_set</span>


<span class="k">def</span> <span class="nf">rename_amenities</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_set</span><span class="p">,</span> <span class="n">amenities_mapping</span><span class="p">):</span>
    <span class="s">"""Clean up amenities names."""</span>
    <span class="n">amenities_set</span> <span class="o">=</span> <span class="p">{</span><span class="n">amen</span> <span class="k">if</span> <span class="n">amen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">amenities_mapping</span>
                     <span class="k">else</span> <span class="n">amenities_mapping</span><span class="p">[</span><span class="n">amen</span><span class="p">]</span> <span class="k">for</span> <span class="n">amen</span> <span class="ow">in</span> <span class="n">amenities_set</span><span class="p">}</span>
    <span class="n">amenities_set</span> <span class="o">=</span> <span class="p">{</span><span class="s">'amen_'</span> <span class="o">+</span> <span class="n">amen</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">amen</span>
                     <span class="ow">in</span> <span class="n">amenities_set</span><span class="p">}</span>

    <span class="c1"># function for renaming amenity lists in series entries
</span>    <span class="k">def</span> <span class="nf">rename_amens</span><span class="p">(</span><span class="n">amenities_mapping</span><span class="p">,</span> <span class="n">amens_entry</span><span class="p">):</span>
        <span class="n">new_amens_entry</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">amen</span> <span class="ow">in</span> <span class="n">amens_entry</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">amen</span> <span class="o">=</span> <span class="n">amenities_mapping</span><span class="p">[</span><span class="n">amen</span><span class="p">]</span>
            <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">amen</span> <span class="o">=</span> <span class="s">'amen_'</span> <span class="o">+</span> <span class="n">amen</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">new_amens_entry</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">amen</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_amens_entry</span>

    <span class="c1"># process amenity list entries in series
</span>    <span class="n">apply_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">rename_amens</span><span class="p">,</span> <span class="n">amenities_mapping</span><span class="p">)</span>
    <span class="n">amenities_series</span> <span class="o">=</span> <span class="n">amenities_series</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">apply_func</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_set</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get renamed series and set of amenities
</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_set</span> <span class="o">=</span> <span class="n">process_amenities</span><span class="p">(</span>
                                      <span class="n">listings_df</span><span class="p">[</span><span class="s">'amenities'</span><span class="p">])</span>
<span class="n">amenities_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s">' toilet'</span><span class="p">:</span> <span class="s">'Toilet'</span><span class="p">,</span>
                     <span class="s">'24hour checkin'</span><span class="p">:</span> <span class="s">'24 hour checkin'</span><span class="p">,</span>
                     <span class="s">'Accessibleheight bed'</span><span class="p">:</span> <span class="s">'Accessible height bed'</span><span class="p">,</span>
                     <span class="s">'Accessibleheight toilet'</span><span class="p">:</span>
                     <span class="s">'Accessible height toilet'</span><span class="p">,</span>
                     <span class="s">'Buzzerwireless intercom'</span><span class="p">:</span> <span class="s">'Buzzer/Wireless intercom'</span><span class="p">,</span>
                     <span class="s">'Familykid friendly'</span><span class="p">:</span> <span class="s">'Family/kid friendly'</span><span class="p">,</span>
                     <span class="s">'Highresolution computer monitor'</span><span class="p">:</span>
                     <span class="s">'High resolution computer monitor'</span><span class="p">,</span>
                     <span class="s">'Pack n Playtravel crib'</span><span class="p">:</span> <span class="s">'Pack-n-Play travel crib'</span><span class="p">,</span>
                     <span class="s">'Roomdarkening shades'</span><span class="p">:</span> <span class="s">'Room darkening shades'</span><span class="p">,</span>
                     <span class="s">'Self checkin'</span><span class="p">:</span> <span class="s">'Self check-in'</span><span class="p">,</span>
                     <span class="s">'SkiinSkiout'</span><span class="p">:</span> <span class="s">'Ski-in/Ski-out'</span><span class="p">,</span>
                     <span class="s">'Stepfree shower'</span><span class="p">:</span> <span class="s">'Step-free shower'</span><span class="p">,</span>
                     <span class="s">'Washer  Dryer'</span><span class="p">:</span> <span class="s">'Washer/Dryer'</span><span class="p">,</span>
                     <span class="s">'Welllit path to entrance'</span><span class="p">:</span>
                     <span class="s">'Well-lit path to entrance'</span><span class="p">}</span>
<span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_set</span> <span class="o">=</span> <span class="n">rename_amenities</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span>
                                                   <span class="n">amenities_set</span><span class="p">,</span>
                                                   <span class="n">amenities_mapping</span><span class="p">)</span>
</code></pre></div></div>

<p>Now we have a series of lists of cleaned up amenity names</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">amenities_series</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>city           
seattle    0       {amen_stove, amen_free_parking_on_premises, am...
           1       {amen_heating, amen_hangers, amen_hair_dryer, ...
           2       {amen_stove, amen_heating, amen_first_aid_kit,...
           3       {amen_well-lit_path_to_entrance, amen_heating,...
           4       {amen_stove, amen_heating, amen_wheelchair_acc...
                                         ...                        
vancouver  6130    {amen_stove, amen_heating, amen_dishwasher, am...
           6145    {amen_stove, amen_heating, amen_bbq_grill, ame...
           6150    {amen_stove, amen_heating, amen_hot_tub, amen_...
           6152    {amen_stove, amen_heating, amen_indoor_firepla...
           6174    {amen_stove, amen_heating, amen_first_aid_kit,...
Name: amenities, Length: 15983, dtype: object
</code></pre></div></div>

<p>And a set of all unique amenities. Let’s see how many there are</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># count number of unique amenities
</span><span class="nb">len</span><span class="p">(</span><span class="n">amenities_set</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>191
</code></pre></div></div>

<p>Let’s whittle this number down by taking amenities which are don’t have extremely unbalanced distributions. We’ll find amenities present in more than 10% but less than 90% of listings.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">count_amenities</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_set</span><span class="p">):</span>
    <span class="s">"""Count total occurences of each amenity in dataset."""</span>
    <span class="n">amenities_count</span> <span class="o">=</span> <span class="p">{</span><span class="n">amen</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">amen</span> <span class="ow">in</span> <span class="n">amenities_set</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">amens_entry</span> <span class="ow">in</span> <span class="n">amenities_series</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">amen</span> <span class="ow">in</span> <span class="n">amens_entry</span><span class="p">:</span>
            <span class="n">amenities_count</span><span class="p">[</span><span class="n">amen</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">amenities_count</span>

<span class="k">def</span> <span class="nf">get_amenities_cols</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_count</span><span class="p">,</span>
                       <span class="n">prop_low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">prop_hi</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
    <span class="s">"""Return amenities with proportion in between thresholds."""</span>
    <span class="c1"># dataframe of amenities counts
</span>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">)</span>
    <span class="n">amenities_prop_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">amenities_count</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'prop'</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">amenities_prop_df</span> <span class="o">=</span> <span class="n">amenities_prop_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s">'prop'</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
    <span class="n">amenities_prop_df</span> <span class="o">=</span> <span class="n">amenities_prop_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'prop &gt;= '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prop_low</span><span class="p">))</span>
    <span class="n">amenities_prop_df</span> <span class="o">=</span> <span class="n">amenities_prop_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'prop &lt;= '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prop_hi</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">amenities_prop_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get amenities present in &gt; 10% and less than 90% of listings
</span><span class="n">amenities_count</span> <span class="o">=</span> <span class="n">count_amenities</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_set</span><span class="p">)</span>
<span class="n">amenities_cols</span> <span class="o">=</span> <span class="n">get_amenities_cols</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_count</span><span class="p">,</span>
                                    <span class="n">prop_low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">prop_hi</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="c1"># check number of these
</span><span class="nb">len</span><span class="p">(</span><span class="n">amenities_cols</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>49
</code></pre></div></div>

<p>That’s a more reasonable number of amenities for us to consider. Finally we’ll create a dataframe of boolean variables the presence/absence of these amenities for each listing. We’ll also include a variable which counts the number of these amenities present for each listing</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_amenities_df</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_cols</span><span class="p">):</span>
    <span class="s">"""Create dataframe of amenities variables."""</span>
    <span class="n">amenities_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">amenities_cols</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">amenities_series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'bool'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_amenity</span><span class="p">(</span><span class="n">amenity</span><span class="p">,</span> <span class="n">amens_entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">amenity</span> <span class="ow">in</span> <span class="n">amens_entry</span>

    <span class="k">for</span> <span class="n">amenity</span> <span class="ow">in</span> <span class="n">amenities_cols</span><span class="p">:</span>
        <span class="n">applyfunc</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">has_amenity</span><span class="p">,</span> <span class="n">amenity</span><span class="p">)</span>
        <span class="n">amenities_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">amenity</span><span class="p">]</span> <span class="o">=</span> <span class="n">amenities_series</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">applyfunc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">num_amenities</span><span class="p">(</span><span class="n">amenities_cols</span><span class="p">,</span> <span class="n">amen_entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">amen_entry</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">amenities_cols</span><span class="p">))</span>

    <span class="n">applyfunc</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">num_amenities</span><span class="p">,</span> <span class="n">amenities_cols</span><span class="p">)</span>
    <span class="n">amenities_df</span><span class="p">[</span><span class="s">'num_amenities'</span><span class="p">]</span> <span class="o">=</span> <span class="n">amenities_series</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">applyfunc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">amenities_df</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe with amenities as boolean columns
</span><span class="n">amenities_df</span> <span class="o">=</span> <span class="n">get_amenities_df</span><span class="p">(</span><span class="n">amenities_series</span><span class="p">,</span> <span class="n">amenities_cols</span><span class="p">)</span>
<span class="n">amenities_df</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>amen_stove</th>
      <th>amen_free_parking_on_premises</th>
      <th>amen_bathtub</th>
      <th>amen_bbq_grill</th>
      <th>amen_indoor_fireplace</th>
      <th>amen_dishwasher</th>
      <th>amen_first_aid_kit</th>
      <th>amen_hot_water</th>
      <th>amen_hair_dryer</th>
      <th>amen_microwave</th>
      <th>amen_pets_allowed</th>
      <th>amen_coffee_maker</th>
      <th>amen_dryer</th>
      <th>amen_oven</th>
      <th>amen_free_street_parking</th>
      <th>amen_garden_or_backyard</th>
      <th>amen_tv</th>
      <th>amen_cooking_basics</th>
      <th>amen_air_conditioning</th>
      <th>amen_safety_card</th>
      <th>amen_cable_tv</th>
      <th>amen_internet</th>
      <th>amen_luggage_dropoff_allowed</th>
      <th>amen_carbon_monoxide_detector</th>
      <th>amen_keypad</th>
      <th>amen_childrens_books_and_toys</th>
      <th>amen_pack-n-play_travel_crib</th>
      <th>amen_lockbox</th>
      <th>amen_fire_extinguisher</th>
      <th>amen_private_living_room</th>
      <th>amen_dishes_and_silverware</th>
      <th>amen_gym</th>
      <th>amen_bed_linens</th>
      <th>amen_elevator</th>
      <th>amen_kitchen</th>
      <th>amen_family/kid_friendly</th>
      <th>amen_extra_pillows_and_blankets</th>
      <th>amen_washer</th>
      <th>amen_single_level_home</th>
      <th>amen_lock_on_bedroom_door</th>
      <th>amen_iron</th>
      <th>amen_refrigerator</th>
      <th>amen_self_check-in</th>
      <th>amen_pets_live_on_this_property</th>
      <th>amen_long_term_stays_allowed</th>
      <th>amen_patio_or_balcony</th>
      <th>amen_laptop_friendly_workspace</th>
      <th>amen_24_hour_checkin</th>
      <th>amen_private_entrance</th>
      <th>num_amenities</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">seattle</th>
      <th>0</th>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>30</td>
    </tr>
    <tr>
      <th>1</th>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2</th>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>26</td>
    </tr>
    <tr>
      <th>3</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>22</td>
    </tr>
    <tr>
      <th>4</th>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>35</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">vancouver</th>
      <th>6130</th>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>24</td>
    </tr>
    <tr>
      <th>6145</th>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>17</td>
    </tr>
    <tr>
      <th>6150</th>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>28</td>
    </tr>
    <tr>
      <th>6152</th>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>25</td>
    </tr>
    <tr>
      <th>6174</th>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>19</td>
    </tr>
  </tbody>
</table>
  <p>15983 rows × 50 columns</p>
</div>

<p>And finally, we’ll add this to our listings dataframe</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># add amenities to listings df
</span><span class="n">listings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">amenities_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
              <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'amenities'</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="currency-conversion">Currency conversion</h3>

<p>The Vancouver prices are expressed in CAD, so we’ll convert to USD. The exchange rate as of November 26, 2019 was 1 CAD = 0.75341 USD.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">conv_cad_to_usd</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="s">"""Currency conversion helper."""</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.76124</span> <span class="o">*</span> <span class="n">entry</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">conv_curr_cols</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">curr_cols</span><span class="p">,</span> <span class="n">curr_conv_func</span><span class="p">):</span>
    <span class="s">"""Convert currency columns."""</span>
    <span class="n">df_cp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_cp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">curr_cols</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">df_cp</span><span class="p">[</span><span class="n">curr_cols</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">conv_cad_to_usd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
                               <span class="k">if</span> <span class="s">'vancouver'</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_cp</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># convert currency columns in listings df
</span><span class="n">list_curr_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'cleaning_fee'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'security_deposit'</span><span class="p">]</span>
<span class="n">listings_df</span> <span class="o">=</span> <span class="n">conv_curr_cols</span><span class="p">(</span><span class="n">listings_df</span><span class="p">,</span> <span class="n">list_curr_cols</span><span class="p">,</span> <span class="n">conv_cad_to_usd</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># workaround for converting calendar columns due to slowness of conv_curr_cols
</span><span class="n">cal_van_price</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'vancouver'</span><span class="p">][</span><span class="s">'price'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">conv_cad_to_usd</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">cal_other_price</span> <span class="o">=</span> <span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s">'seattle'</span><span class="p">,</span> <span class="s">'portland'</span><span class="p">]][</span><span class="s">'price'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">calendar_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'price'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cal_other_price</span><span class="p">,</span> <span class="n">cal_van_price</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="save-cleaned-datasets">Save cleaned datasets</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># save dfs as h5 files to save write time
</span><span class="n">listings_df</span> <span class="o">=</span> <span class="n">alphabetize_cols</span><span class="p">(</span><span class="n">listings_df</span><span class="p">)</span>
<span class="n">listings_df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s">'data/listings.h5'</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">'listings'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'w'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'table'</span><span class="p">)</span>
<span class="n">calendar_df</span> <span class="o">=</span> <span class="n">alphabetize_cols</span><span class="p">(</span><span class="n">calendar_df</span><span class="p">,</span> <span class="n">first_col</span><span class="o">=</span><span class="s">'listing_id'</span><span class="p">)</span>
<span class="n">calendar_df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s">'data/calendar.h5'</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">'calendar'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'w'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'table'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># delete unwanted dataset
</span><span class="n">datadir</span> <span class="o">=</span> <span class="s">'./data'</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">datadir</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'csv'</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datadir</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
</code></pre></div></div>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', functione. {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
